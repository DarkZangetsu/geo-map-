"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4203],{4203:(e,t,r)=>{r.d(t,{A:()=>b});var s=r(5155),i=r(2115),l=r(5028),a=r(4437);r(1191);var n=r(5752),o=r.n(n);let d=new(o()).DivIcon({className:"",iconSize:[36,42],iconAnchor:[18,42],popupAnchor:[0,-36],html:'\n    <svg width="36" height="42" viewBox="0 0 36 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <g filter="url(#shadow)">\n        <path d="M18 2C10.268 2 4 8.268 4 16.001c0 7.732 11.09 22.13 13.97 25.89a2 2 0 0 0 3.06 0C20.91 38.13 32 23.733 32 16.001 32 8.268 25.732 2 18 2Z" fill="#2563eb"/>\n        <circle cx="18" cy="16" r="6" fill="#fff" stroke="#2563eb" stroke-width="2"/>\n      </g>\n      <defs>\n        <filter id="shadow" x="0" y="0" width="36" height="42" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n          <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#000" flood-opacity="0.2"/>\n        </filter>\n      </defs>\n    </svg>\n  '}),c=(0,l.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),m=(0,l.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),u=(0,l.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),h=(0,l.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),x=(0,l.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.Polygon),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),p=new(o()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),g=new(o()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),b=e=>{let{parcelles:t,sieges:r=[],pepinieres:l=[],onParcelleClick:n,onSiegeClick:o,onPepiniereClick:b,mapStyle:f="street",style:v,center:w,mode:j="parcelle"}=e,[N,y]=(0,i.useState)(null),[k,S]=(0,i.useState)(!1),[A,z]=(0,i.useState)(0),G=(0,i.useRef)(null),P=(0,i.useRef)(null),C=e=>{if(!e)return null;if("string"==typeof e)try{return JSON.parse(e)}catch(e){return null}return e},E=e=>{if(!e||!Array.isArray(e[0]))return null;let t=e[0].map(e=>[...e]),r=0,s=0,i=t.length;return t.forEach(e=>{let[t,i]=e;r+=t,s+=i}),[s/i,r/i]};(0,i.useEffect)(()=>{z(e=>e+1)},[t]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{if(G.current&&(G.current.invalidateSize(),t&&t.length>0)){let e=[];t.forEach(t=>{if(t.geojson&&t.geojson.coordinates){let r=t.geojson.coordinates[0].map(e=>[e[1],e[0]]);e.push(...r)}}),e.length>0&&G.current.fitBounds(e,{padding:[20,20]})}},100);return()=>clearTimeout(e)},[t,A]),(0,i.useLayoutEffect)(()=>{setTimeout(()=>{G.current&&G.current.invalidateSize&&G.current.invalidateSize()},200)},[]);let I=(e,t)=>{if(y(e),n&&n(e),t&&t.coordinates&&G.current){let e=t.coordinates[0].map(e=>[e[1],e[0]]);G.current.fitBounds(e,{maxZoom:17,padding:[40,40]})}};return(0,s.jsxs)("div",{className:"w-full h-full relative flex",style:{height:void 0!==v&&v.height?v.height:"100%",width:void 0!==v&&v.width?v.width:"100%",minHeight:void 0!==v&&v.height?void 0:"400px",minWidth:void(void 0!==v&&v.width),margin:0,padding:0},children:[(0,s.jsxs)(c,{ref:G,center:w||[-18.7669,46.8691],zoom:6,style:{height:"100%",width:"100%",minHeight:void 0!==v&&v.height?void 0:"400px",minWidth:void(void 0!==v&&v.width)},className:"z-0",maxBounds:[[-25.607,43.254],[-11.945,50.483]],maxBoundsViscosity:1,maxZoom:19,whenReady:()=>{setTimeout(()=>{G.current&&G.current.invalidateSize&&G.current.invalidateSize()},200)},onClick:e=>{y(null)},children:[(0,s.jsx)(m,{url:{street:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",satellite:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",hybrid:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}[f],attribution:{street:"\xa9 OpenStreetMap contributors",satellite:"Tiles \xa9 Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",hybrid:"\xa9 Esri"}[f]}),"satellite"===f&&(0,s.jsx)(m,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",attribution:"Labels \xa9 Esri"}),"hybrid"===f&&(0,s.jsx)(m,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 OpenStreetMap contributors",opacity:.7}),"parcelle"===j&&Array.isArray(t)&&t.length>0&&t.map(e=>{let t=C(e.geojson),r=null;return t&&"Polygon"===t.type&&t.coordinates&&(r=E(t.coordinates)),(0,s.jsxs)("div",{children:[t&&t.coordinates&&(0,s.jsx)(x,{positions:t.coordinates[0].map(e=>[e[1],e[0]]),pathOptions:{color:"#3b82f6",weight:2,fillOpacity:.2},eventHandlers:{click:()=>I(e,t)}}),r&&(0,s.jsx)(u,{position:r,icon:d,eventHandlers:{click:()=>I(e,t)}})]},e.id)}),"siege"===j&&r.map(e=>{let t=e.latitude?parseFloat(e.latitude):null,r=e.longitude?parseFloat(e.longitude):null;return null===t||null===r||isNaN(t)||isNaN(r)?null:(0,s.jsx)(u,{position:[t,r],icon:p,eventHandlers:{click:()=>{setSelectedSiege(e),o&&o(e)}}},e.id)}),"pepinieres"===j&&l.map(e=>{let t=e.latitude?parseFloat(e.latitude):null,r=e.longitude?parseFloat(e.longitude):null;return null===t||null===r||isNaN(t)||isNaN(r)?null:(0,s.jsx)(u,{position:[t,r],icon:g,eventHandlers:{click:()=>b&&b(e)},children:(0,s.jsx)(h,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:e.nom}),(0,s.jsx)("br",{}),e.adresse,(0,s.jsx)("br",{}),"Lat: ",e.latitude,", Lng: ",e.longitude]})})},e.id)})]},A),N&&(0,s.jsxs)("div",{className:"fixed top-0 right-0 h-full w-full sm:w-[420px] bg-gradient-to-br from-slate-50 to-white backdrop-blur-lg shadow-xl z-50 overflow-y-auto flex flex-col border-0 rounded-3xl m-3 max-w-[440px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 bg-gradient-to-r from-blue-50/80 to-indigo-50/80 backdrop-blur-sm sticky top-0 z-10 rounded-t-3xl border-b border-blue-100/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[N.user.logo?(0,s.jsx)("img",{src:N.user.logo.startsWith("http")?N.user.logo:"".concat("https://api.allianceagroforesterie.mg","/media/").concat(N.user.logo),alt:"Logo",className:"w-10 h-10 rounded-full object-cover border border-orange-200 bg-white"}):(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center border border-orange-200",children:(0,s.jsxs)("svg",{width:"24",height:"24",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{cx:"12",cy:"8",r:"4"}),(0,s.jsx)("path",{d:"M4 20c0-4 4-7 8-7s8 3 8 7"})]})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-slate-800 tracking-tight",children:"D\xe9tails du site de r\xe9f\xe9rence"})]}),(0,s.jsx)("button",{onClick:()=>y(null),className:"text-slate-400 hover:text-blue-500 text-2xl transition-all duration-200 rounded-2xl p-2 hover:bg-blue-50/50 focus:outline-none focus:ring-2 focus:ring-blue-200",title:"Fermer",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-5",children:[(0,s.jsx)("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:(0,s.jsx)("div",{className:"font-semibold text-xl text-slate-800 mb-2",children:N.nom||"Sans nom"})}),(N.nomPersonneReferente||N.poste||N.telephone||N.email)&&(0,s.jsxs)("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-emerald-400 rounded-full"}),(0,s.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Personne r\xe9f\xe9rente"})]}),N.nomPersonneReferente&&(0,s.jsx)("div",{className:"text-base font-medium text-slate-800 mb-1",children:N.nomPersonneReferente}),N.poste&&(0,s.jsx)("div",{className:"text-sm text-slate-600 mb-1",children:N.poste}),N.telephone&&(0,s.jsx)("div",{className:"text-sm text-slate-600 mb-1",children:N.telephone}),N.email&&(0,s.jsx)("div",{className:"text-sm text-slate-600",children:N.email})]}),N.superficie&&(0,s.jsxs)("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),(0,s.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Superficie"})]}),(0,s.jsxs)("div",{className:"text-lg font-medium text-slate-800",children:[N.superficie," ha"]})]}),N.pratique&&(0,s.jsxs)("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-purple-400 rounded-full"}),(0,s.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Pratique"})]}),(0,s.jsx)("div",{className:"text-base font-medium text-slate-800",children:N.pratique})]}),N.nomProjet&&(0,s.jsxs)("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-rose-400 rounded-full"}),(0,s.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Projet"})]}),(0,s.jsx)("div",{className:"text-base font-medium text-slate-800",children:N.nomProjet})]}),N.description&&(0,s.jsxs)("div",{className:"bg-white/70 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-teal-400 rounded-full"}),(0,s.jsx)("div",{className:"text-xs font-medium text-slate-500 uppercase tracking-wide",children:"Description"})]}),(0,s.jsx)("div",{className:"text-sm text-slate-700 leading-relaxed",children:N.description})]}),Array.isArray(N.images)&&N.images.length>0&&(0,s.jsxs)("button",{onClick:()=>{S(!0),setTimeout(()=>{P.current&&P.current.scrollIntoView({behavior:"smooth",block:"start"})},100)},className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-2xl font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02]",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Voir les images (",N.images.length,")"]}),k&&N&&(0,s.jsxs)("div",{ref:P,className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-sm border border-slate-100/50 p-5",children:[(0,s.jsxs)("div",{className:"mb-4 text-lg font-semibold text-slate-800 flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl flex items-center justify-center",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),"Galerie d'images"]}),(0,s.jsx)("div",{className:"bg-slate-50/50 rounded-xl p-3 border border-slate-200/50",children:(0,s.jsx)(a.A,{items:(e=>{if(!e||!Array.isArray(e)||0===e.length)return[];let t=e.filter(e=>e&&e.image);return 0===t.length?[]:(t.some(e=>"number"==typeof e.ordre&&0!==e.ordre)?[...t].sort((e,t)=>(e.ordre||0)-(t.ordre||0)):[...t]).map((e,t)=>({original:"".concat("https://api.allianceagroforesterie.mg","/media/").concat(e.image),thumbnail:"".concat("https://api.allianceagroforesterie.mg","/media/").concat(e.image),description:"Image ".concat(void 0!==e.ordre?e.ordre+1:t+1)}))})(N.images),showPlayButton:!1,showFullscreenButton:!0,showNav:!0,showThumbnails:!0,slideInterval:3e3,slideOnThumbnailOver:!0,additionalClass:"custom-gallery"})}),(0,s.jsx)("button",{onClick:()=>S(!1),className:"mt-4 w-full px-4 py-3 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl font-medium transition-colors duration-200",children:"Fermer la galerie"})]})]})]})]})}}}]);