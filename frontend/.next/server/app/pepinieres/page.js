(()=>{var e={};e.id=657,e.ids=[657],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16319:(e,t,s)=>{Promise.resolve().then(s.bind(s,38405))},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},35533:(e,t,s)=>{"use strict";s.d(t,{z:()=>n}),s(43210);var i=s(16189),r=s(89162);function n(e=!0){let{user:t,isAuthenticated:s,isLoading:a}=(0,r.h)();return(0,i.useRouter)(),{user:t,isAuthenticated:s,isLoading:a,isAuthorized:!e||s}}s(65222)},38405:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>q});var i=s(60687),r=s(43210),n=s(22710),a=s(8829),o=s(89162),l=s(16189),d=s(48443),c=s(35533),u=s(66362),m=s(13861),p=s(63143),x=s(96362),g=s(96474),h=s(22982),b=s(47033),f=s(14952),j=s(92049),v=s(11703),y=s(48840),N=s(16023),w=s(11860),C=s(9005);let P=({onSuccess:e,onCancel:t,initialData:s=null,mode:o="add",pepiniereId:l=null})=>{let[c,u]=(0,r.useState)({nom:"",adresse:"",latitude:"",longitude:"",description:"",nomGestionnaire:"",posteGestionnaire:"",telephoneGestionnaire:"",emailGestionnaire:"",especesProduites:"",nomProjet:"",quantiteProductionGenerale:""}),[m,p]=(0,r.useState)([]),[x,g]=(0,r.useState)(!1),{showSuccess:h,showError:b}=(0,j.d)(),[f,{loading:P}]=(0,n.n)(d.JL),[G,{loading:k}]=(0,n.n)(d.mb),{data:S}=(0,a.IT)(d.QG),z=(S?.me?.nomProjet||"").split(",").map(e=>e.trim()).filter(Boolean);(0,r.useEffect)(()=>{s&&(u({nom:s.nom||"",adresse:s.adresse||"",latitude:s.latitude||"",longitude:s.longitude||"",description:s.description||"",nomGestionnaire:s.nomGestionnaire||"",posteGestionnaire:s.posteGestionnaire||"",telephoneGestionnaire:s.telephoneGestionnaire||"",emailGestionnaire:s.emailGestionnaire||"",especesProduites:s.especesProduites||"",nomProjet:s.nomProjet||"",quantiteProductionGenerale:s.quantiteProductionGenerale||""}),s.photos&&p(s.photos.slice(0,3).map(e=>({id:e.id,url:e.image?e.image.startsWith("http")?e.image:`${"https://api.allianceagroforesterie.mg/media/".replace(/\/$/,"")}/${e.image.replace(/^\//,"")}`:"",titre:e.titre||"",description:e.description||"",isExisting:!0}))))},[s]);let A=e=>{let{name:t,value:s}=e.target;u(e=>({...e,[t]:s}))},I=e=>{p(t=>t.filter((t,s)=>s!==e))},q=(e,t,s)=>{p(i=>i.map((i,r)=>r===e?{...i,[t]:s}:i))},E=e=>{e&&"Point"===e.type&&2===e.coordinates.length?u(t=>({...t,latitude:e.coordinates[1],longitude:e.coordinates[0]})):b("Veuillez s\xe9lectionner un point sur la carte.")},[V,L]=(0,r.useState)(!1),[M,U]=(0,r.useState)(!1),_=e=>{if(e.preventDefault(),!c.nom||!c.adresse||!c.latitude||!c.longitude)return void b("Veuillez remplir tous les champs obligatoires.");L(!0)},$=async()=>{U(!0);try{let t=m.filter(e=>!e.isExisting).map(e=>e.file);if("edit"===o&&l){let{data:s}=await G({variables:{id:l,nom:c.nom,adresse:c.adresse,latitude:parseFloat(c.latitude),longitude:parseFloat(c.longitude),description:c.description,nomGestionnaire:c.nomGestionnaire,posteGestionnaire:c.posteGestionnaire,telephoneGestionnaire:c.telephoneGestionnaire,emailGestionnaire:c.emailGestionnaire,especesProduites:c.especesProduites,nomProjet:c.nomProjet,quantiteProductionGenerale:c.quantiteProductionGenerale,photos:t}});s.updatePepiniere.success?(h("P\xe9pini\xe8re mise \xe0 jour avec succ\xe8s."),e&&e()):b(s.updatePepiniere.message||"Erreur lors de la mise \xe0 jour.")}else{let{data:s}=await f({variables:{nom:c.nom,adresse:c.adresse,latitude:parseFloat(c.latitude),longitude:parseFloat(c.longitude),description:c.description,nomGestionnaire:c.nomGestionnaire,posteGestionnaire:c.posteGestionnaire,telephoneGestionnaire:c.telephoneGestionnaire,emailGestionnaire:c.emailGestionnaire,especesProduites:c.especesProduites,nomProjet:c.nomProjet,quantiteProductionGenerale:c.quantiteProductionGenerale,photos:t}});s.createPepiniere.success?(h("P\xe9pini\xe8re cr\xe9\xe9e avec succ\xe8s."),e&&e()):b(s.createPepiniere.message||"Erreur lors de la cr\xe9ation.")}L(!1)}catch(e){b("Erreur lors de la soumission de la p\xe9pini\xe8re."),console.error("Erreur lors de la soumission:",e)}finally{U(!1)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"bg-white border-b border-gray-200 p-6 rounded-t-lg",children:(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"edit"===o?"Modifier la p\xe9pini\xe8re":"Ajouter une p\xe9pini\xe8re"})}),(0,i.jsx)("div",{className:"bg-white overflow-y-auto max-h-[60vh]",children:(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom *"}),(0,i.jsx)("input",{type:"text",name:"nom",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.nom,onChange:A})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom du projet"}),(0,i.jsxs)("select",{name:"nomProjet",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.nomProjet,onChange:A,children:[(0,i.jsx)("option",{value:"",children:"S\xe9lectionner un projet"}),z.map((e,t)=>(0,i.jsx)("option",{value:e,children:e},t))]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse *"}),(0,i.jsx)("input",{type:"text",name:"adresse",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.adresse,onChange:A})]}),(0,i.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Latitude *"}),(0,i.jsx)("input",{type:"number",step:"0.000001",name:"latitude",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.latitude,onChange:A})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Longitude *"}),(0,i.jsx)("input",{type:"number",step:"0.000001",name:"longitude",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.longitude,onChange:A})]}),(0,i.jsx)("button",{type:"button",onClick:()=>g(!0),className:"ml-2 px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"S\xe9lectionner sur la carte"})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations du gestionnaire"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom du gestionnaire"}),(0,i.jsx)("input",{type:"text",name:"nomGestionnaire",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.nomGestionnaire,onChange:A})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Poste du gestionnaire"}),(0,i.jsx)("input",{type:"text",name:"posteGestionnaire",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.posteGestionnaire,onChange:A})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"T\xe9l\xe9phone du gestionnaire"}),(0,i.jsx)("input",{type:"tel",name:"telephoneGestionnaire",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.telephoneGestionnaire,onChange:A})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email du gestionnaire"}),(0,i.jsx)("input",{type:"email",name:"emailGestionnaire",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.emailGestionnaire,onChange:A})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations de production"}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esp\xe8ces produites"}),(0,i.jsx)("textarea",{name:"especesProduites",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.especesProduites,onChange:A,placeholder:"Liste des esp\xe8ces produites"})]})}),(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantit\xe9 de production g\xe9n\xe9rale"}),(0,i.jsx)("textarea",{name:"quantiteProductionGenerale",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.quantiteProductionGenerale,onChange:A,placeholder:"Description de la production g\xe9n\xe9rale"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,i.jsx)("textarea",{name:"description",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:c.description,onChange:A})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Photos de la p\xe9pini\xe8re (max 3)"}),(0,i.jsxs)("div",{className:"space-y-4",children:[m.length<2&&(0,i.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,i.jsx)(N.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsxs)("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"Cliquez pour ajouter une photo"}),(0,i.jsx)("input",{id:"photo-upload",type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files);if(m.length+t.length>3)return void b("Vous pouvez ajouter au maximum 3 photos.");let s=t.map(e=>({file:e,url:URL.createObjectURL(e),titre:"",description:"",isExisting:!1}));p(e=>[...e,...s].slice(0,3))},className:"hidden"})]})}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG jusqu'\xe0 10MB"})]}),m.length>0&&(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map((e,t)=>(0,i.jsxs)("div",{className:"relative border rounded-lg p-4",children:[(0,i.jsx)("button",{type:"button",onClick:()=>I(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,i.jsx)(w.A,{size:16})}),(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,i.jsx)(C.A,{className:"h-8 w-8 text-gray-400"}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)("input",{type:"text",placeholder:"Titre de la photo",value:e.titre,onChange:e=>q(t,"titre",e.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1"})})]}),(0,i.jsx)("img",{src:e.url,alt:e.titre||"Photo de la p\xe9pini\xe8re",className:"w-full h-32 object-cover rounded"}),(0,i.jsx)("textarea",{placeholder:"Description de la photo",value:e.description,onChange:e=>q(t,"description",e.target.value),className:"w-full mt-2 text-sm border border-gray-300 rounded px-2 py-1 resize-none",rows:"2"})]},t))})]})]})]})})}),(0,i.jsx)("div",{className:"bg-white border-t border-gray-200 p-6 rounded-b-lg",children:(0,i.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,i.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Annuler"}),(0,i.jsx)("button",{onClick:_,disabled:P||k,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:P||k?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"edit"===o?"Mise \xe0 jour...":"Cr\xe9ation..."]}):"edit"===o?"Mettre \xe0 jour":"Cr\xe9er la p\xe9pini\xe8re"})]})}),x&&(0,i.jsx)(y.A,{open:x,onClose:()=>g(!1),onSave:e=>{E(e),g(!1)},initialPosition:c.latitude&&c.longitude?[parseFloat(c.latitude),parseFloat(c.longitude)]:null}),V&&(0,i.jsx)(v.A,{isOpen:V,onClose:()=>L(!1),onConfirm:$,title:"edit"===o?"Confirmer la modification":"Confirmer la cr\xe9ation",message:"edit"===o?"Voulez-vous vraiment modifier cette p\xe9pini\xe8re ?":"Voulez-vous vraiment cr\xe9er cette p\xe9pini\xe8re ?",confirmText:"edit"===o?"Mettre \xe0 jour":"Cr\xe9er",confirmButtonClass:M?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700",cancelButtonClass:M?"cursor-not-allowed":"bg-gray-300 hover:bg-gray-400",confirmDisabled:M,confirmLoading:M})]})},G=({open:e,onClose:t,onSuccess:s,initialData:r=null,mode:n="add",pepiniereId:a=null})=>e?(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 p-4",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl p-0 max-w-4xl w-full max-h-[90vh] overflow-y-auto relative animate-fade-in",children:[(0,i.jsx)("button",{onClick:t,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl font-bold focus:outline-none z-10","aria-label":"Fermer",children:"\xd7"}),(0,i.jsx)(P,{onSuccess:e=>{s&&s(e),t&&t()},onCancel:t,initialData:r,mode:n,pepiniereId:a})]})}):null;var k=s(30120),S=s(32168),z=s(76717),A=s(36713),I=s(79887);function q(){let{isLoading:e,isAuthorized:t}=(0,c.z)(!0),{user:s,isAuthenticated:y,isLoading:N}=(0,o.h)(),w=(0,l.useRouter)(),[C]=(0,r.useState)(null),[P,q]=(0,r.useState)(!1),[E,V]=(0,r.useState)(!1),[L]=(0,r.useState)(""),[M]=(0,r.useState)("nom"),[U]=(0,r.useState)("asc"),[_,$]=(0,r.useState)(1),[R,D]=(0,r.useState)(10),[W,F]=(0,r.useState)("street"),[H,O]=(0,r.useState)([{key:"nom",label:"P\xe9pini\xe8re"},{key:"adresse",label:"Adresse"},{key:"nomGestionnaire",label:"Gestionnaire"},{key:"nomProjet",label:"Projet rattach\xe9"}].map(e=>e.key)),{showSuccess:B,showError:T}=(0,j.d)(),[Q,K]=(0,r.useState)(null),[J]=(0,n.n)(d.kv),[X,Z]=(0,r.useState)(!1),[Y,ee]=(0,r.useState)(!1),[et,es]=(0,r.useState)(!1),[ei,er]=(0,r.useState)(null),[en,ea]=(0,r.useState)(!1),[eo,el]=(0,r.useState)(null),[ed,ec]=(0,r.useState)(!1),{data:eu,loading:em,refetch:ep}=(0,a.IT)(d.z7,{skip:!y||s&&("ADMIN"===s.role||"admin"===s.role)}),ex=eu?.myPepinieres||[];if(e||!t)return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:e?"V\xe9rification de l'authentification...":"Redirection vers la page de connexion..."})]})});if(!N&&(!y||!s||"ADMIN"===s.role||"admin"===s.role))return w.push("/"),null;let eg=e=>{K(e),ee(!0)},eh=e=>{el(e),ea(!0)},eb=async()=>{if(eo){ec(!0);try{let{data:e}=await J({variables:{id:eo.id}});e.deletePepiniere.success?(B("P\xe9pini\xe8re supprim\xe9e avec succ\xe8s"),ep()):T(e.deletePepiniere.message)}catch(e){T("Erreur lors de la suppression")}finally{ec(!1),ea(!1),el(null)}}},ef=e=>{er(e),es(!0)},ej=(0,r.useMemo)(()=>{let e=ex;if(L){let t=L.toLowerCase();e=e.filter(e=>H.some(s=>{let i=e[s];return null!=i&&String(i).toLowerCase().includes(t)}))}return[...e].sort((e,t)=>{let s=e[M]||"",i=t[M]||"";return("string"==typeof s&&(s=s.toLowerCase()),"string"==typeof i&&(i=i.toLowerCase()),s<i)?"asc"===U?-1:1:s>i?"asc"===U?1:-1:0})},[ex,L,M,U,H]),ev=(0,r.useMemo)(()=>{let e=(_-1)*R;return ej.slice(e,e+R)},[ej,_,R]),ey=Math.ceil(ej.length/R),eN=(0,r.useMemo)(()=>[H.includes("nom")&&{accessorKey:"nom",header:"P\xe9pini\xe8re",cell:e=>e.getValue()},H.includes("adresse")&&{accessorKey:"adresse",header:"Adresse",cell:e=>e.getValue()},H.includes("nomGestionnaire")&&{accessorKey:"Gestionnaire",header:"Gestionnaire",cell:e=>{let t=e.row.original;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium",children:t.nomGestionnaire||"-"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:t.posteGestionnaire||"-"})]})}},H.includes("nomProjet")&&{accessorKey:"projet rattach\xe9",header:"Projet rattach\xe9",cell:e=>e.row.original.nomProjet},{id:"actions",header:()=>(0,i.jsx)("div",{className:"text-center",children:"Actions"}),cell:({row:e})=>(0,i.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,i.jsx)(z.$,{variant:"outline",size:"sm",onClick:()=>ef(e.original),title:"Voir les d\xe9tails",className:"text-blue-600 hover:text-blue-800",children:(0,i.jsx)(m.A,{size:15})}),(0,i.jsx)(z.$,{variant:"outline",size:"sm",onClick:()=>eg(e.original),title:"Modifier la p\xe9pini\xe8re",children:(0,i.jsx)(p.A,{size:15})}),(0,i.jsx)(z.$,{variant:"destructive",size:"sm",onClick:()=>eh(e.original),title:"Supprimer la p\xe9pini\xe8re",children:(0,i.jsx)(x.A,{size:15})}),(0,i.jsx)(v.A,{open:en,title:"Confirmer la suppression",description:eo?`\xcates-vous s\xfbr de vouloir supprimer la p\xe9pini\xe8re \xab ${eo.nom} \xbb ? Cette action est irr\xe9versible.`:"",confirmLabel:ed?"Suppression...":"Supprimer",cancelLabel:"Annuler",onCancel:()=>{ea(!1),el(null)},onConfirm:eb,loading:ed,variant:"destructive"})]}),enableSorting:!1,enableHiding:!1}].filter(Boolean),[H]),ew=(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsxs)(A.l6,{value:String(R),onValueChange:e=>{D(Number(e)),$(1)},children:[(0,i.jsx)(A.bq,{className:"w-32",children:(0,i.jsx)(A.yv,{placeholder:"Lignes par page"})}),(0,i.jsx)(A.gC,{children:[10,25,50].map(e=>(0,i.jsxs)(A.eb,{value:String(e),children:[e," par page"]},e))})]})});return(0,i.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,i.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,i.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-6",children:[(0,i.jsxs)("div",{className:"flex-shrink-0",children:[(0,i.jsx)("h1",{className:"text-2xl lg:text-3xl font-extrabold midnight-blue-text drop-shadow-sm",children:"Mes p\xe9pini\xe8res"}),(0,i.jsxs)("p",{className:"text-gray-700 mt-1 font-medium text-sm lg:text-base",children:[ex.length," p\xe9pini\xe8re",1!==ex.length?"s":""," au total"]})]}),!(P||E)&&(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,i.jsxs)(z.$,{onClick:()=>{K(null),ee(!0)},className:"px-4 py-2 midnight-blue-btn rounded-md shadow font-bold transition flex items-center justify-center gap-2 text-sm",title:"Ajouter une nouvelle p\xe9pini\xe8re",children:[(0,i.jsx)(g.A,{size:16})," Ajouter une p\xe9pini\xe8re"]}),(0,i.jsxs)(z.$,{onClick:()=>Z(!0),className:"px-4 py-2 midnight-blue-btn rounded-md shadow font-bold transition flex items-center justify-center gap-2 text-sm",title:"Import/Export CSV",children:[(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Import/Export CSV"]})]}),(P||E)&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("select",{value:W,onChange:e=>F(e.target.value),className:"px-3 py-2 border midnight-blue-border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200 bg-white midnight-blue-text font-semibold shadow-sm text-sm",children:[(0,i.jsx)("option",{value:"street",children:"Carte routi\xe8re"}),(0,i.jsx)("option",{value:"satellite",children:"Satellite"}),(0,i.jsx)("option",{value:"hybrid",children:"Hybride"})]}),!E&&(0,i.jsx)(z.$,{onClick:()=>V(!0),className:"px-3 py-2 midnight-blue-btn rounded-md font-semibold shadow-sm transition text-sm",title:"Afficher la carte en plein \xe9cran",children:"Plein \xe9cran"}),E&&(0,i.jsx)(z.$,{onClick:()=>V(!1),className:"px-3 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 font-semibold shadow-sm transition text-sm",title:"Quitter le plein \xe9cran",children:"Quitter"})]})]})}),P||E?(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"flex justify-end mb-2",children:(0,i.jsxs)(z.$,{onClick:()=>q(!1),variant:"outline",className:"px-3 py-2 rounded-md border midnight-blue-border bg-white midnight-blue-text hover:bg-blue-50 flex items-center gap-2 shadow-sm transition font-semibold text-sm",children:[(0,i.jsx)(h.A,{size:16}),(0,i.jsx)("span",{className:"hidden sm:inline",children:"Voir le tableau"}),(0,i.jsx)("span",{className:"sm:hidden",children:"Tableau"})]})}),(0,i.jsx)("div",{className:E?"fixed inset-0 z-50 bg-white bg-opacity-95 flex items-center justify-center":"bg-white rounded-lg shadow-lg overflow-hidden",style:E?{height:"100vh",width:"100vw"}:{},children:(0,i.jsxs)("div",{className:E?"w-full h-full flex flex-col bg-white rounded-none shadow-none relative":"bg-white rounded-lg shadow-lg overflow-hidden",style:E?{maxWidth:"100vw",maxHeight:"100vh"}:{},children:[E&&(0,i.jsx)(z.$,{onClick:()=>V(!1),className:"absolute top-4 right-4 z-50 px-4 py-2 bg-gray-700 text-white rounded-xl shadow-lg hover:bg-gray-900 font-bold transition",title:"Quitter le plein \xe9cran",children:"Quitter plein \xe9cran"}),(0,i.jsxs)("div",{className:"p-4 border-b",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Carte des p\xe9pini\xe8res"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:[ex.length," p\xe9pini\xe8re",1!==ex.length?"s":""," affich\xe9e",1!==ex.length?"s":""," sur la carte"]})]}),(0,i.jsx)("div",{style:E?{flex:1,minHeight:0,minWidth:0}:{height:"600px",width:"100%"},children:em?(0,i.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),(0,i.jsx)("p",{className:"mt-2 text-gray-600",children:"Chargement de la carte..."})]})}):(0,i.jsx)(k.A,{pepinieres:ex,onPepiniereClick:C,mapStyle:W,style:{height:"100%",minHeight:400}})})]})})]}):(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"flex justify-end mb-2",children:(0,i.jsxs)(z.$,{onClick:()=>q(!0),variant:"outline",className:"midnight-blue-text midnight-blue-border border rounded-md hover:bg-blue-50 flex items-center justify-center gap-2 font-bold transition text-sm shadow-sm",title:"Voir la carte",children:[(0,i.jsx)(h.A,{size:16}),(0,i.jsx)("span",{className:"hidden sm:inline",children:"Voir la carte"}),(0,i.jsx)("span",{className:"sm:hidden",children:"Carte"})]})}),(0,i.jsxs)("div",{className:"bg-white rounded-b-lg shadow-lg overflow-hidden",children:[(0,i.jsx)(S.b,{columns:eN,data:ev,filterKey:"nom",filterPlaceholder:"Rechercher par nom...",actions:ew}),(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-b-2xl border-t border-blue-100",children:[(0,i.jsxs)("div",{className:"text-sm text-blue-900 font-semibold",children:["Page ",_," sur ",ey]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(z.$,{variant:"outline",size:"sm",disabled:1===_,onClick:()=>$(_-1),className:"flex items-center gap-1",children:[(0,i.jsx)(b.A,{size:14})," ",(0,i.jsx)("span",{className:"hidden sm:inline",children:"Pr\xe9c\xe9dent"})]}),(0,i.jsxs)(z.$,{variant:"outline",size:"sm",disabled:_===ey,onClick:()=>$(_+1),className:"flex items-center gap-1",children:[(0,i.jsx)("span",{className:"hidden sm:inline",children:"Suivant"})," ",(0,i.jsx)(f.A,{size:14})]})]})]})]}),(0,i.jsx)(G,{open:Y,onClose:()=>{ee(!1),K(null)},initialData:Q,mode:Q?"edit":"add",pepiniereId:Q?Q.id:null,onSuccess:()=>{ee(!1),K(null),ep()}}),X&&(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full p-6 relative",children:[(0,i.jsx)(z.$,{onClick:()=>Z(!1),className:"absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-xl font-bold",title:"Fermer",children:"\xd7"}),(0,i.jsx)(u.A,{onImportSuccess:()=>{Z(!1),ep()}})]})}),et&&ei&&(0,i.jsx)(I.A,{pepiniere:ei,onClose:()=>{es(!1),er(null)}})]})]})}},48840:(e,t,s)=>{"use strict";s.d(t,{A:()=>b});var i=s(60687),r=s(43210),n=s(19496),a=s(47594),o=s(61467),l=s(27321),d=s(91299),c=s(97638),u=s.n(c);let m=(0,l.Nq)(function({position:e,...t},s){let i=new c.Marker(e,t);return(0,d.Q)(i,(0,n.W4)(s,{overlayContainer:i}))},function(e,t,s){t.position!==s.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==s.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==s.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==s.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==s.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())});s(63245);let p={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},x={background:"white",borderRadius:"8px",padding:"24px",width:"600px",minWidth:"350px",height:"500px",minHeight:"400px",maxWidth:"90vw",maxHeight:"90vh",display:"flex",flexDirection:"column"},g=new(u()).Icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function h({position:e,setPosition:t}){return!function(e){let t=(0,n.U$)().map;(0,r.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e])}({click(e){t([e.latlng.lat,e.latlng.lng])}}),null}let b=({open:e,onClose:t,onSave:s,initialPosition:n})=>{let[l,d]=(0,r.useState)(n||null),[c,u]=(0,r.useState)("standard");return e?(0,i.jsx)("div",{style:{...p,zIndex:1e3},children:(0,i.jsxs)("div",{style:{...x,width:"100vw",minWidth:"100vw",height:"100vh",minHeight:"100vh",maxWidth:"100vw",maxHeight:"100vh",padding:0,boxSizing:"border-box",display:"flex",flexDirection:"column"},children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",style:{padding:"16px 24px 0 24px"},children:[(0,i.jsx)("h2",{className:"text-lg font-bold",children:"S\xe9lectionner la position du si\xe8ge"}),(0,i.jsx)("div",{className:"flex items-center space-x-2",children:(0,i.jsxs)("select",{value:c,onChange:e=>u(e.target.value),className:"px-2 py-1 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-100",style:{fontSize:"0.95em"},children:[(0,i.jsx)("option",{value:"standard",children:"Standard"}),(0,i.jsx)("option",{value:"satellite",children:"Satellite + labels"})]})})]}),(0,i.jsx)("div",{style:{flex:1,minHeight:0},children:(0,i.jsxs)(a.W,{center:l||[-19,47],zoom:l?12:6,style:{height:"100%",width:"100%"},children:["standard"===c&&(0,i.jsx)(o.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 OpenStreetMap contributors"}),"satellite"===c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.e,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles \xa9 Esri â€” Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),(0,i.jsx)(o.e,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",attribution:"Labels \xa9 Esri"})]}),(0,i.jsx)(h,{position:l,setPosition:d}),l&&(0,i.jsx)(m,{position:l,icon:g})]})}),(0,i.jsxs)("div",{className:"flex justify-end mt-4 space-x-2",style:{background:"white",padding:"0 24px 24px 24px",borderBottomLeftRadius:8,borderBottomRightRadius:8,boxShadow:"0 -2px 8px rgba(0,0,0,0.04)"},children:[(0,i.jsx)("button",{onClick:t,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Annuler"}),(0,i.jsx)("button",{onClick:()=>{l&&(s({type:"Point",coordinates:[l[1],l[0]]}),t())},disabled:!l,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",children:"Valider"})]})]})}):null}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72933:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});let i=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\User\\\\Videos\\\\Nouveau dossier\\\\geomap\\\\geo-map-\\\\frontend\\\\src\\\\app\\\\pepinieres\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\pepinieres\\page.js","default")},74910:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>a.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var i=s(65239),r=s(48088),n=s(88170),a=s.n(n),o=s(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let d={children:["",{children:["pepinieres",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,72933)),"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\pepinieres\\page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,75535)),"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(s.bind(s,28069)),"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\not-found.js"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\pepinieres\\page.js"],u={require:s,loadChunk:()=>Promise.resolve()},m=new i.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/pepinieres/page",pathname:"/pepinieres",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},76999:(e,t,s)=>{Promise.resolve().then(s.bind(s,72933))}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[176,804,829,995,852,349,111,899,975,887,946,589],()=>s(74910));module.exports=i})();