(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{255:(e,t,r)=>{"use strict";function n(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return n}}),r(5155),r(7650),r(5744),r(589)},1191:()=>{},2146:(e,t,r)=>{"use strict";function n(e){let{reason:t,children:r}=e;return r}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),r(5262)},2262:(e,t,r)=>{Promise.resolve().then(r.bind(r,6171))},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{bindSnapshot:function(){return i},createAsyncLocalStorage:function(){return s},createSnapshot:function(){return a}});let r=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw r}getStore(){}run(){throw r}exit(){throw r}enterWith(){throw r}static bind(e){return e}}let l="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function s(){return l?new l:new n}function i(e){return l?l.bind(e):n.bind(e)}function a(){return l?l.snapshot():function(e,...t){return e(...t)}}},5028:(e,t,r)=>{"use strict";r.d(t,{default:()=>l.a});var n=r(6645),l=r.n(n)},5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},5744:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return n.workAsyncStorageInstance}});let n=r(7828)},6171:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var n=r(5155);r(5695);var l=r(1929),s=r(3593),i=r(2115),a=r(5028);r(1191);var o=r(5752),u=r.n(o),d=r(5753),c=r(1947),h=r(4664);let p=new(u()).DivIcon({className:"",iconSize:[36,42],iconAnchor:[18,42],popupAnchor:[0,-36],html:'\n    <svg width="36" height="42" viewBox="0 0 36 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <g filter="url(#shadow)">\n        <path d="M18 2C10.268 2 4 8.268 4 16.001c0 7.732 11.09 22.13 13.97 25.89a2 2 0 0 0 3.06 0C20.91 38.13 32 23.733 32 16.001 32 8.268 25.732 2 18 2Z" fill="#2563eb"/>\n        <circle cx="18" cy="16" r="6" fill="#fff" stroke="#2563eb" stroke-width="2"/>\n      </g>\n      <defs>\n        <filter id="shadow" x="0" y="0" width="36" height="42" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n          <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#000" flood-opacity="0.2"/>\n        </filter>\n      </defs>\n    </svg>\n  '}),f=new(u()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),m=new(u()).Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),g=(0,a.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),b=(0,a.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),x=(0,a.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),y=(0,a.default)(()=>r.e(1802).then(r.bind(r,1802)).then(e=>e.Polygon),{loadableGenerated:{webpack:()=>[1802]},ssr:!1}),v=[-18.7669,46.8691],j=[[-25.607,43.254],[-11.945,50.483]],w={street:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",satellite:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",hybrid:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"},S={street:"\xa9 OpenStreetMap contributors",satellite:"Tiles \xa9 Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",hybrid:"\xa9 Esri"};function _(e){let{parcelles:t=[],sieges:r=[],pepinieres:l=[],mapStyle:s="street",style:a,center:o}=e,[u,_]=(0,i.useState)(null),[k,N]=(0,i.useState)(null),[P,A]=(0,i.useState)(null),[O,C]=(0,i.useState)(0),E=(0,i.useRef)(null);return(0,i.useEffect)(()=>{C(e=>e+1)},[t,r,l]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{E.current&&E.current.invalidateSize()},100);return()=>clearTimeout(e)},[O]),(0,i.useLayoutEffect)(()=>{setTimeout(()=>{E.current&&E.current.invalidateSize&&E.current.invalidateSize()},200)},[]),(0,n.jsxs)("div",{className:"w-full h-full relative flex",style:{height:(null==a?void 0:a.height)||"100%",width:(null==a?void 0:a.width)||"100%",minHeight:(null==a?void 0:a.height)?void 0:"400px",minWidth:void(null==a||a.width),margin:0,padding:0},children:[(0,n.jsxs)(g,{ref:E,center:o||v,zoom:6,style:{height:"100%",width:"100%",minHeight:(null==a?void 0:a.height)?void 0:"400px",minWidth:void(null==a||a.width)},className:"z-0",maxBounds:j,maxBoundsViscosity:1,maxZoom:19,whenReady:()=>{setTimeout(()=>{E.current&&E.current.invalidateSize&&E.current.invalidateSize()},200)},onClick:()=>{_(null),N(null),A(null)},children:[(0,n.jsx)(b,{url:w[s],attribution:S[s]}),"satellite"===s&&(0,n.jsx)(b,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",attribution:"Labels \xa9 Esri"}),"hybrid"===s&&(0,n.jsx)(b,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 OpenStreetMap contributors",opacity:.7}),Array.isArray(t)&&t.map(e=>{let t=function(e){if(!e)return null;if("string"==typeof e)try{return JSON.parse(e)}catch(e){return null}return e}(e.geojson),r=null;return t&&"Polygon"===t.type&&t.coordinates&&(r=[(r=t.coordinates[0].reduce((e,t)=>[e[0]+t[0],e[1]+t[1]],[0,0]))[1]/t.coordinates[0].length,r[0]/t.coordinates[0].length]),(0,n.jsxs)(i.Fragment,{children:[t&&t.coordinates&&(0,n.jsx)(y,{positions:t.coordinates[0].map(e=>[e[1],e[0]]),pathOptions:{color:"#3b82f6",weight:2,fillOpacity:.2},eventHandlers:{click:()=>{if(_(e),E.current&&t.coordinates){let e=t.coordinates[0].map(e=>[e[1],e[0]]);E.current.fitBounds(e,{maxZoom:17,padding:[40,40]})}}}}),r&&(0,n.jsx)(x,{position:r,icon:p,eventHandlers:{click:()=>{_(e),E.current&&r&&E.current.setView(r,17,{animate:!0})}}})]},e.id)}),Array.isArray(r)&&r.map(e=>(0,n.jsx)(x,{position:[parseFloat(e.latitude),parseFloat(e.longitude)],icon:f,eventHandlers:{click:()=>{N(e),E.current&&E.current.setView([parseFloat(e.latitude),parseFloat(e.longitude)],17,{animate:!0})}}},e.id)),Array.isArray(l)&&l.map(e=>(0,n.jsx)(x,{position:[parseFloat(e.latitude),parseFloat(e.longitude)],icon:m,eventHandlers:{click:()=>{A(e),E.current&&E.current.setView([parseFloat(e.latitude),parseFloat(e.longitude)],17,{animate:!0})}}},e.id))]},O),P&&(0,n.jsx)(d.A,{pepiniere:P,onClose:()=>A(null)}),u&&(0,n.jsx)(h.A,{parcelle:u,onClose:()=>_(null)}),k&&(0,n.jsx)(c.A,{siege:k,onClose:()=>N(null)})]})}function k(){var e;let{data:t,loading:r,error:a}=(0,l.IT)(s.xh),{data:o,loading:u,error:d}=(0,l.IT)(s._Q),{data:c,loading:h,error:p}=(0,l.IT)(s.KZ),{data:f}=(0,l.IT)(s.em),[m,g]=(0,i.useState)("street"),[b,x]=(0,i.useState)(!0),[y,v]=(0,i.useState)(!0),[j,w]=(0,i.useState)(!0),[S,k]=(0,i.useState)(""),[N,P]=(0,i.useState)(""),A=(null==t?void 0:t.allParcelles)||[],O=(null==o?void 0:o.allSieges)||[],C=(null==c?void 0:c.allPepinieres)||[];function E(e,t,r){return e.filter(e=>{var n,l;let s=(e.nom||"")+" "+((null==(n=e.user)?void 0:n.firstName)||"")+" "+((null==(l=e.user)?void 0:l.lastName)||""),i=!t||s.toLowerCase().includes(t.toLowerCase()),a=!r||e.user&&e.user.id===r;return i&&a})}let I=b?E(A,S,N):[],z=y?E(O,S,N):[],M=j?E(C,S,N):[],G=I&&I.length>0;return(0,n.jsxs)("div",{style:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column"},children:[(0,n.jsxs)("div",{className:"bg-white flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-6 py-4 border-b shadow-sm",style:{flex:"0 0 auto"},children:[(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)("h1",{className:"ml-4 text-2xl font-extrabold text-blue-900",children:"Carte g\xe9n\xe9rale"})}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,n.jsx)("input",{type:"text",value:S,onChange:e=>k(e.target.value),placeholder:"Rechercher par nom, propri\xe9taire...",className:"px-3 py-2 border border-blue-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-blue-900 font-semibold shadow-sm"}),(0,n.jsxs)("select",{value:N,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-blue-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-blue-900 font-semibold shadow-sm",children:[(0,n.jsx)("option",{value:"",children:"Tous les institutions"}),null==f||null==(e=f.allUsers)?void 0:e.map(e=>(0,n.jsxs)("option",{value:e.id,children:["(",e.nomInstitution,")"]},e.id))]}),(0,n.jsxs)("label",{className:"flex items-center gap-2 text-blue-900 font-semibold bg-blue-50 px-3 py-2 rounded-lg border border-blue-100",children:[(0,n.jsx)("input",{type:"checkbox",checked:b,onChange:()=>x(e=>!e),className:"accent-blue-600"}),"Sites de r\xe9f\xe9rence",(0,n.jsx)("span",{className:"ml-1 text-xs bg-blue-200 text-blue-900 rounded px-2 py-0.5 font-bold",children:A.length})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2 text-red-900 font-semibold bg-red-50 px-3 py-2 rounded-lg border border-red-100",children:[(0,n.jsx)("input",{type:"checkbox",checked:y,onChange:()=>v(e=>!e),className:"accent-red-600"}),"Locaux",(0,n.jsx)("span",{className:"ml-1 text-xs bg-red-200 text-red-900 rounded px-2 py-0.5 font-bold",children:O.length})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2 text-green-900 font-semibold bg-green-50 px-3 py-2 rounded-lg border border-green-100",children:[(0,n.jsx)("input",{type:"checkbox",checked:j,onChange:()=>w(e=>!e),className:"accent-green-600"}),"P\xe9pini\xe8res",(0,n.jsx)("span",{className:"ml-1 text-xs bg-green-200 text-green-900 rounded px-2 py-0.5 font-bold",children:C.length})]}),(0,n.jsxs)("select",{value:m,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-blue-900 font-semibold shadow-sm",children:[(0,n.jsx)("option",{value:"street",children:"Carte routi\xe8re"}),(0,n.jsx)("option",{value:"satellite",children:"Satellite"}),(0,n.jsx)("option",{value:"hybrid",children:"Hybride"})]})]})]}),(0,n.jsx)("div",{style:{flex:1,minHeight:0,height:"100%"},children:r||u||h?(0,n.jsx)("div",{className:"flex items-center justify-center h-full text-lg text-blue-700 font-semibold",children:"Chargement de la carte..."}):a?(0,n.jsxs)("div",{className:"flex items-center justify-center h-full text-lg text-red-700 font-semibold",children:["Erreur d'acc\xe8s aux parcelles : ",a.message]}):d?(0,n.jsxs)("div",{className:"flex items-center justify-center h-full text-lg text-red-700 font-semibold",children:["Erreur d'acc\xe8s aux si\xe8ges : ",d.message]}):p?(0,n.jsxs)("div",{className:"flex items-center justify-center h-full text-lg text-red-700 font-semibold",children:["Erreur d'acc\xe8s aux p\xe9pini\xe8res : ",p.message]}):(0,n.jsx)("div",{style:{height:"100%",width:"100%"},children:(0,n.jsx)(_,{parcelles:I,sieges:z,pepinieres:M,mapStyle:m,style:{height:"100%",width:"100%"},center:G?void 0:[-18.7669,46.8691]},I.length+"-"+z.length+"-"+M.length+"-"+m)})})]})}},6645:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let n=r(8229)._(r(7357));function l(e,t){var r;let l={};"function"==typeof e&&(l.loader=e);let s={...l,...t};return(0,n.default)({...s,modules:null==(r=s.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7357:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let n=r(5155),l=r(2115),s=r(2146);function i(e){return{default:e&&"default"in e?e.default:e}}r(255);let a={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},o=function(e){let t={...a,...e},r=(0,l.lazy)(()=>t.loader().then(i)),o=t.loading;function u(e){let i=o?(0,n.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,a=!t.ssr||!!t.loading,u=a?l.Suspense:l.Fragment,d=t.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(r,{...e})]}):(0,n.jsx)(s.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(r,{...e})});return(0,n.jsx)(u,{...a?{fallback:i}:{},children:d})}return u.displayName="LoadableComponent",u}},7828:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return n}});let n=(0,r(4054).createAsyncLocalStorage)()}},e=>{var t=t=>e(e.s=t);e.O(0,[2046,1761,2871,8916,1929,6800,4664,5753,1947,8441,1684,7358],()=>t(2262)),_N_E=e.O()}]);