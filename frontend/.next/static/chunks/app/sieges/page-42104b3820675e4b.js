(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6443],{4025:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var i=s(5155),r=s(2115),l=s(8095),n=s(1929),a=s(6254),o=s(5695),d=s(3593),c=s(5489),m=s(6358),u=s(2657),x=s(3717),h=s(4126),g=s(4616),p=s(3578),b=s(2355),j=s(3052),f=s(5369);let v=e=>{let{onImportSuccess:t}=e,[s,n]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),[c,m]=(0,r.useState)(!1),[u,x]=(0,r.useState)([]),{showSuccess:h,showError:g}=(0,f.d)(),[p]=(0,l.n)(d.X6),[b]=(0,l.n)(d.gm),j=async()=>{o(!0);try{let{data:e}=await p();if(e.exportSiegesCsv.success){let t=new Blob([e.exportSiegesCsv.csvData],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),i=URL.createObjectURL(t);s.setAttribute("href",i),s.setAttribute("download","locaux_export_".concat(new Date().toISOString().split("T")[0],".csv")),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),h(e.exportSiegesCsv.message)}else g(e.exportSiegesCsv.message)}catch(e){g("Erreur lors de l'export CSV"),console.error("Export error:",e)}finally{o(!1)}},v=async()=>{if(!s)return void g("Veuillez s\xe9lectionner un fichier CSV \xe0 importer.");m(!0);try{let{data:e}=await b({variables:{csvFile:s}});if(e.importSiegesCsv.success){h(e.importSiegesCsv.message),n(null),x(e.importSiegesCsv.errors||[]);let s=document.getElementById("csv-siege-file-input");s&&(s.value=""),t&&t()}else g(e.importSiegesCsv.message),x(e.importSiegesCsv.errors||[])}catch(e){g("Erreur lors de l'import CSV"),console.error("Import error:",e)}finally{m(!1)}};return(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-semibold mb-6 text-gray-800 text-center",children:"Import/Export CSV des locaux"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("h4",{className:"text-lg font-medium text-gray-700",children:"Exporter les locaux"}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:"T\xe9l\xe9chargez tous vos locaux au format CSV pour sauvegarder ou partager vos donn\xe9es."}),(0,i.jsx)("button",{onClick:j,disabled:a,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center",children:a?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Export en cours..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exporter en CSV"]})})]}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("h4",{className:"text-lg font-medium text-gray-700",children:"Importer des locaux"}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:"Importez des locaux depuis un fichier CSV. T\xe9l\xe9chargez d'abord le mod\xe8le pour voir le format attendu."}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("button",{onClick:()=>{let e=new Blob(['Nom,Adresse,Latitude,Longitude,Description,Cat\xe9gorie,Nom Point Contact,Poste,T\xe9l\xe9phone,Email,Nom Projet,Horaire Matin,Horaire Apr\xe8s-midi\n"Si\xe8ge Principal Paris","123 Avenue des Champs-\xc9lys\xe9es, 75008 Paris",48.866667,2.333333,"Si\xe8ge social principal de l\'entreprise",social,"Jean Dupont","Directeur G\xe9n\xe9ral","+33 1 23 45 67 89",jean.dupont@entreprise.com,"Projet Alpha","08:00 - 12:00","14:00 - 18:00"\n"Si\xe8ge R\xe9gional Lyon","Place Bellecour, 69002 Lyon",45,764043,4,835659,"Si\xe8ge r\xe9gional pour le Sud-Est",regional,"Marie Martin","Responsable R\xe9gionale","+33 4 78 90 12 34",marie.martin@entreprise.com,"Projet Beta","09:00 - 12:30","13:30 - 17:30"'],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),s=URL.createObjectURL(e);t.setAttribute("href",s),t.setAttribute("download","template_locaux.csv"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center",children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"T\xe9l\xe9charger le mod\xe8le CSV"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"csv-siege-file-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"S\xe9lectionner un fichier CSV"}),(0,i.jsx)("input",{id:"csv-siege-file-input",type:"file",accept:".csv",onChange:e=>{let t=e.target.files[0];t&&"text/csv"===t.type?(n(t),x([])):(g("Veuillez s\xe9lectionner un fichier CSV valide."),n(null))},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),(0,i.jsx)("button",{onClick:v,disabled:!s||c,className:"w-full bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center",children:c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Import en cours..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Importer le CSV"]})})]})]})]}),u.length>0&&(0,i.jsxs)("div",{className:"mt-6",children:[(0,i.jsx)("h5",{className:"text-sm font-medium text-red-700 mb-2",children:"Erreurs d'import :"}),(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 max-h-40 overflow-y-auto",children:u.map((e,t)=>(0,i.jsxs)("div",{className:"text-sm text-red-600 mb-1",children:["• ",e]},t))})]}),(0,i.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 rounded-md",children:[(0,i.jsx)("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Instructions :"}),(0,i.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,i.jsxs)("li",{children:["• Les champs ",(0,i.jsx)("strong",{children:"Nom"}),", ",(0,i.jsx)("strong",{children:"Adresse"}),", ",(0,i.jsx)("strong",{children:"Latitude"})," et ",(0,i.jsx)("strong",{children:"Longitude"})," sont obligatoires"]}),(0,i.jsx)("li",{children:"• Les coordonn\xe9es doivent \xeatre des nombres (ex: 48.8566, 2.3522)"}),(0,i.jsx)("li",{children:"• Les champs optionnels : Description, Cat\xe9gorie, Nom Point Contact, Poste, T\xe9l\xe9phone, Email, Nom Projet, Horaire Matin, Horaire Apr\xe8s-midi"}),(0,i.jsx)("li",{children:"• Cat\xe9gories possibles : social, regional, technique, provisoire (d\xe9faut: social)"}),(0,i.jsx)("li",{children:"• L'utilisateur sera automatiquement associ\xe9 lors de l'enregistrement"})]})]})]})};var y=s(8565),N=s(9869),C=s(4416),w=s(7213),S=s(3225);let k=e=>{var t;let{onSuccess:s,onCancel:a,initialData:o=null,mode:c="add",siegeId:m=null}=e,[u,x]=(0,r.useState)({nom:"",adresse:"",latitude:"",longitude:"",description:"",categorie:"social",nomPointContact:"",poste:"",telephone:"",email:"",nomProjet:"",horaireMatin:"",horaireApresMidi:""}),[h,g]=(0,r.useState)([]),[p,b]=(0,r.useState)(!1),{showSuccess:j,showError:v}=(0,f.d)(),[k,{loading:A}]=(0,l.n)(d.Tf),[P,{loading:M}]=(0,l.n)(d.EF),[L,z]=(0,r.useState)(!1),[V,E]=(0,r.useState)(!1),{data:H}=(0,n.IT)(d.QG),B=((null==H||null==(t=H.me)?void 0:t.nomProjet)||"").split(",").map(e=>e.trim()).filter(Boolean);(0,r.useEffect)(()=>{if(o&&(x({nom:o.nom||"",adresse:o.adresse||"",latitude:o.latitude||"",longitude:o.longitude||"",description:o.description||"",categorie:o.categorie||"social",nomPointContact:o.nomPointContact||"",poste:o.poste||"",telephone:o.telephone||"",email:o.email||"",nomProjet:o.nomProjet||"",horaireMatin:o.horaireMatin||"",horaireApresMidi:o.horaireApresMidi||""}),o.photosBatiment)){let e="".concat("https://api.allianceagroforesterie.mg","/media/")||0;g(o.photosBatiment.slice(0,3).map(t=>({id:t.id,url:t.image?t.image.startsWith("http")?t.image:"".concat(e.replace(/\/$/,""),"/").concat(t.image.replace(/^\//,"")):"",titre:t.titre||"",description:t.description||"",isExisting:!0})))}},[o]);let F=e=>{let{name:t,value:s}=e.target;x(e=>({...e,[t]:s}))},I=e=>{g(t=>t.filter((t,s)=>s!==e))},D=(e,t,s)=>{g(i=>i.map((i,r)=>r===e?{...i,[t]:s}:i))},T=e=>{e&&"Point"===e.type&&2===e.coordinates.length?x(t=>({...t,latitude:e.coordinates[1],longitude:e.coordinates[0]})):v("Veuillez s\xe9lectionner un point sur la carte.")},q=e=>{e.preventDefault(),z(!0)},R=async()=>{E(!0);try{let e=h.filter(e=>!e.isExisting).map(e=>e.file);if("edit"===c&&m){let{data:t}=await P({variables:{id:m,nom:u.nom,adresse:u.adresse,latitude:parseFloat(u.latitude),longitude:parseFloat(u.longitude),description:u.description,categorie:u.categorie,nomPointContact:u.nomPointContact,poste:u.poste,telephone:u.telephone,email:u.email,nomProjet:u.nomProjet,horaireMatin:u.horaireMatin,horaireApresMidi:u.horaireApresMidi,photosBatiment:e}});t.updateSiege.success?(j("Local modifi\xe9 avec succ\xe8s !"),s&&s(t.updateSiege.siege)):v(t.updateSiege.message)}else{let{data:t}=await k({variables:{nom:u.nom,adresse:u.adresse,latitude:parseFloat(u.latitude),longitude:parseFloat(u.longitude),description:u.description,categorie:u.categorie,nomPointContact:u.nomPointContact,poste:u.poste,telephone:u.telephone,email:u.email,nomProjet:u.nomProjet,horaireMatin:u.horaireMatin,horaireApresMidi:u.horaireApresMidi,photosBatiment:e}});t.createSiege.success?(j("Local ajout\xe9 avec succ\xe8s !"),s&&s(t.createSiege.siege)):v(t.createSiege.message)}}catch(e){console.error("Erreur lors de la soumission:",e),v("Erreur lors de la soumission du local.")}finally{E(!1),z(!1)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"bg-white border-b border-gray-200 p-6 rounded-t-lg",children:(0,i.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"edit"===c?"Modifier le local":"Ajouter un local"})}),(0,i.jsx)("div",{className:"bg-white overflow-y-auto max-h-[60vh]",children:(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("form",{onSubmit:q,className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom *"}),(0,i.jsx)("input",{type:"text",name:"nom",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.nom,onChange:F})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cat\xe9gorie"}),(0,i.jsxs)("select",{name:"categorie",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.categorie,onChange:F,children:[(0,i.jsx)("option",{value:"social",children:"Si\xe8ge social"}),(0,i.jsx)("option",{value:"regional",children:"Si\xe8ge r\xe9gional"}),(0,i.jsx)("option",{value:"technique",children:"Si\xe8ge technique"}),(0,i.jsx)("option",{value:"provisoire",children:"Si\xe8ge provisoire"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Projet rattach\xe9"}),(0,i.jsxs)("select",{name:"nomProjet",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.nomProjet,onChange:F,children:[(0,i.jsx)("option",{value:"",children:"S\xe9lectionner un projet"}),B.map((e,t)=>(0,i.jsx)("option",{value:e,children:e},t))]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse *"}),(0,i.jsx)("input",{type:"text",name:"adresse",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.adresse,onChange:F})]}),(0,i.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Latitude *"}),(0,i.jsx)("input",{type:"number",step:"0.000001",name:"latitude",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.latitude,onChange:F})]}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Longitude *"}),(0,i.jsx)("input",{type:"number",step:"0.000001",name:"longitude",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.longitude,onChange:F})]}),(0,i.jsx)("button",{type:"button",onClick:()=>b(!0),className:"ml-2 px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"S\xe9lectionner sur la carte"})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Point de contact"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nom du point de contact"}),(0,i.jsx)("input",{type:"text",name:"nomPointContact",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.nomPointContact,onChange:F})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Poste"}),(0,i.jsx)("input",{type:"text",name:"poste",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.poste,onChange:F})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"T\xe9l\xe9phone"}),(0,i.jsx)("input",{type:"tel",name:"telephone",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.telephone,onChange:F})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,i.jsx)("input",{type:"email",name:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.email,onChange:F})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Horaires d'ouverture"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horaires du matin"}),(0,i.jsx)("input",{type:"text",name:"horaireMatin",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.horaireMatin,onChange:F,placeholder:"ex: 8h-12h"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Horaires de l'apr\xe8s-midi"}),(0,i.jsx)("input",{type:"text",name:"horaireApresMidi",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.horaireApresMidi,onChange:F,placeholder:"ex: 14h-18h"})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,i.jsx)("textarea",{name:"description",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",value:u.description,onChange:F})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Photos du b\xe2timent (max 3)"}),(0,i.jsxs)("div",{className:"space-y-4",children:[h.length<2&&(0,i.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,i.jsx)(N.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsxs)("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[(0,i.jsx)("span",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"Cliquez pour ajouter une photo"}),(0,i.jsx)("input",{id:"photo-upload",type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files);if(h.length+t.length>3)return void v("Vous pouvez ajouter au maximum 3 photos.");let s=t.map(e=>({file:e,url:URL.createObjectURL(e),titre:"",description:"",isExisting:!1}));g(e=>[...e,...s].slice(0,3))},className:"hidden"})]})}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PNG, JPG jusqu'\xe0 10MB"})]}),h.length>0&&(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:h.map((e,t)=>(0,i.jsxs)("div",{className:"relative border rounded-lg p-4",children:[(0,i.jsx)("button",{type:"button",onClick:()=>I(t),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,i.jsx)(C.A,{size:16})}),(0,i.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,i.jsx)(w.A,{className:"h-8 w-8 text-gray-400"}),(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsx)("input",{type:"text",placeholder:"Titre de la photo",value:e.titre,onChange:e=>D(t,"titre",e.target.value),className:"w-full text-sm border border-gray-300 rounded px-2 py-1"})})]}),(0,i.jsx)("img",{src:e.url,alt:e.titre||"Photo du b\xe2timent",className:"w-full h-32 object-cover rounded"}),(0,i.jsx)("textarea",{placeholder:"Description de la photo",value:e.description,onChange:e=>D(t,"description",e.target.value),className:"w-full mt-2 text-sm border border-gray-300 rounded px-2 py-1 resize-none",rows:"2"})]},t))})]})]})]})})}),(0,i.jsx)("div",{className:"bg-white border-t border-gray-200 p-6 rounded-b-lg",children:(0,i.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,i.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Annuler"}),(0,i.jsx)("button",{onClick:q,disabled:A||M,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:A||M?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"edit"===c?"Mise \xe0 jour...":"Cr\xe9ation..."]}):"edit"===c?"Mettre \xe0 jour":"Ajouter le local"})]})}),L&&(0,i.jsx)(S.A,{isOpen:L,onClose:()=>z(!1),onConfirm:R,title:"edit"===c?"Confirmer la modification":"Confirmer la cr\xe9ation",message:"edit"===c?"Voulez-vous vraiment modifier ce local ?":"Voulez-vous vraiment ajouter ce local ?",confirmText:"edit"===c?"Mettre \xe0 jour":"Ajouter",confirmButtonClass:V?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700",cancelButtonClass:V?"cursor-not-allowed":"bg-gray-300 hover:bg-gray-400",confirmDisabled:V,confirmLoading:V}),p&&(0,i.jsx)(y.A,{open:p,onClose:()=>b(!1),onSave:e=>{T(e),b(!1)},initialPosition:u.latitude&&u.longitude?[parseFloat(u.latitude),parseFloat(u.longitude)]:null})]})},A=e=>{let{open:t,onClose:s,initialData:r=null,mode:l="add",siegeId:n=null,onSuccess:a}=e;return t?(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 p-4",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl p-0 max-w-4xl w-full max-h-[90vh] overflow-y-auto relative animate-fade-in",children:[(0,i.jsx)("button",{onClick:s,className:"absolute top-2 right-2 text-gray-400 hover:text-gray-700 text-2xl font-bold focus:outline-none z-10","aria-label":"Fermer",children:"\xd7"}),(0,i.jsx)(k,{initialData:r,mode:l,siegeId:n,onSuccess:e=>{a&&a(e),s&&s()},onCancel:s})]})}):null};var P=s(6927),M=s(183),L=s(7075),z=s(1947);let V={social:"Si\xe8ge social",regional:"Si\xe8ge r\xe9gional",technique:"Si\xe8ge technique",provisoire:"Si\xe8ge provisoire"};function E(){let{isLoading:e,isAuthorized:t}=(0,c.z)(!0),{user:s,isAuthenticated:y,isLoading:N}=(0,a.h)(),C=(0,o.useRouter)(),[w,k]=(0,r.useState)(!1),[E,H]=(0,r.useState)(!1),[B,F]=(0,r.useState)("street"),[I]=(0,r.useState)(""),[D,T]=(0,r.useState)(1),[q,R]=(0,r.useState)(10),[$]=(0,r.useState)(["nom","categorie","adresse","pointContact","horaires","nomProjet"]),{showSuccess:W,showError:_}=(0,f.d)(),[O,U]=(0,r.useState)(null),[G]=(0,l.n)(d.Wj),[J,K]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(!1),[Y,Z]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(null),[es,ei]=(0,r.useState)(!1),[er,el]=(0,r.useState)(null),[en,ea]=(0,r.useState)(!1),{data:eo,loading:ed,refetch:ec}=(0,n.IT)(d.lH,{skip:!y||s&&("ADMIN"===s.role||"admin"===s.role)}),em=(null==eo?void 0:eo.mySieges)||[];if(e||!t)return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,i.jsx)("p",{className:"mt-4 text-gray-600",children:e?"V\xe9rification de l'authentification...":"Redirection vers la page de connexion..."})]})});if(!N&&(!y||!s||"ADMIN"===s.role||"admin"===s.role))return C.push("/"),null;let eu=e=>{},ex=(0,r.useMemo)(()=>{let e=em;if(I){let t=I.toLowerCase();e=e.filter(e=>$.some(s=>{let i=e[s];return null!=i&&String(i).toLowerCase().includes(t)}))}return e},[em,I,$]),eh=(0,r.useMemo)(()=>{let e=(D-1)*q;return ex.slice(e,e+q)},[ex,D,q]),eg=Math.ceil(ex.length/q),ep=e=>{U(e),X(!0)},eb=e=>{el(e),ei(!0)},ej=async()=>{if(er){ea(!0);try{let{data:e}=await G({variables:{id:er.id}});e.deleteSiege.success?(W("Local supprim\xe9 avec succ\xe8s"),ec()):_(e.deleteSiege.message)}catch(e){_("Erreur lors de la suppression")}finally{ea(!1),ei(!1),el(null)}}},ef=e=>{et(e),Z(!0)},ev=(0,r.useMemo)(()=>[$.includes("nom")&&{id:"nom",header:"Locaux",cell:e=>e.row.original.nom||"-"},$.includes("categorie")&&{id:"Cat\xe9gorie",header:"Cat\xe9gorie",cell:e=>{let t=e.row.original.categorie;return V[(t||"").toLowerCase()]||t||"-"}},$.includes("adresse")&&{id:"Adresse",header:"Adresse",cell:e=>e.row.original.adresse||"-"},$.includes("pointContact")&&{id:"Point de Contact",header:"Point de Contact",cell:e=>{let t=e.row.original;return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium",children:t.nomPointContact||"-"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:t.poste||"-"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:t.telephone||"-"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:t.email||"-"})]})}},$.includes("horaires")&&{id:"Horaires",header:"Horaires",cell:e=>{let t=e.row.original;return(0,i.jsxs)("div",{className:"text-xs",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Matin:"})," ",t.horaireMatin||"-"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Apr\xe8s-midi:"})," ",t.horaireApresMidi||"-"]})]})}},$.includes("nomProjet")&&{id:"Projet rattach\xe9",header:"Projet rattach\xe9",cell:e=>e.row.original.nomProjet||"-"},{id:"actions",header:()=>(0,i.jsx)("div",{className:"text-center",children:"Actions"}),cell:e=>{let{row:t}=e;return(0,i.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,i.jsx)(M.$,{variant:"outline",size:"sm",onClick:()=>ef(t.original),title:"Voir les d\xe9tails",className:"text-blue-600 hover:text-blue-800",children:(0,i.jsx)(u.A,{size:15})}),(0,i.jsx)(M.$,{variant:"outline",size:"sm",onClick:()=>ep(t.original),title:"Modifier le local",children:(0,i.jsx)(x.A,{size:15})}),(0,i.jsx)(M.$,{variant:"destructive",size:"sm",onClick:()=>eb(t.original),title:"Supprimer le local",children:(0,i.jsx)(h.A,{size:15})})]})},enableSorting:!1,enableHiding:!1}].filter(Boolean),[$]),ey=(0,i.jsx)("div",{className:"flex items-center gap-2",children:(0,i.jsxs)(L.l6,{value:String(q),onValueChange:e=>{R(Number(e)),T(1)},children:[(0,i.jsx)(L.bq,{className:"w-32",children:(0,i.jsx)(L.yv,{placeholder:"Lignes par page"})}),(0,i.jsx)(L.gC,{children:[10,25,50].map(e=>(0,i.jsxs)(L.eb,{value:String(e),children:[e," par page"]},e))})]})});return(0,r.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      :root {\n        --midnight-blue: rgb(0,70,144);\n      }\n      .midnight-blue-bg {\n        background-color: var(--midnight-blue) !important;\n        color: #fff !important;\n      }\n      .midnight-blue-text {\n        color: var(--midnight-blue) !important;\n      }\n      .midnight-blue-border {\n        border-color: var(--midnight-blue) !important;\n      }\n      .midnight-blue-btn {\n        background-color: var(--midnight-blue) !important;\n        color: #fff !important;\n        border: 1px solid var(--midnight-blue) !important;\n      }\n      .midnight-blue-btn:hover {\n        background-color: #003366 !important;\n        color: #fff !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,i.jsx)("div",{className:"min-h-screen bg-white",children:(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,i.jsxs)("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-6",children:[(0,i.jsxs)("div",{className:"flex-shrink-0",children:[(0,i.jsx)("h1",{className:"text-2xl lg:text-3xl font-extrabold midnight-blue-text drop-shadow-sm",children:"Mes locaux"}),(0,i.jsxs)("p",{className:"text-gray-700 mt-1 font-medium text-sm lg:text-base",children:[em.length," local",1!==em.length?"s":""," au total"]})]}),!(w||E)&&(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,i.jsxs)(M.$,{onClick:()=>{U(null),X(!0)},className:"midnight-blue-btn rounded-md flex items-center justify-center gap-2 font-bold transition text-sm",title:"Ajouter un nouveau local",children:[(0,i.jsx)(g.A,{size:16})," Ajouter un local"]}),(0,i.jsxs)(M.$,{onClick:()=>K(!0),className:"midnight-blue-btn rounded-md flex items-center justify-center gap-2 font-bold transition text-sm",title:"Import/Export CSV",children:[(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Import/Export CSV"]})]})]}),w?(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"flex justify-end mb-2",children:(0,i.jsxs)("button",{onClick:()=>k(!1),className:"px-3 py-2 rounded-md border midnight-blue-border bg-white midnight-blue-text hover:bg-blue-50 flex items-center gap-2 shadow-sm transition font-semibold text-sm",children:[(0,i.jsx)(p.A,{size:16}),(0,i.jsx)("span",{className:"hidden sm:inline",children:"Voir le tableau"}),(0,i.jsx)("span",{className:"sm:hidden",children:"Tableau"})]})}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,i.jsxs)("div",{className:"p-4 border-b flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Carte des locaux"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:[em.length," local",1!==em.length?"s":""," affich\xe9",1!==em.length?"s":""," sur la carte"]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("select",{value:B,onChange:e=>F(e.target.value),className:"px-3 py-2 border border-blue-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white text-blue-900 font-semibold shadow-sm text-sm",children:[(0,i.jsx)("option",{value:"street",children:"Carte routi\xe8re"}),(0,i.jsx)("option",{value:"satellite",children:"Satellite"}),(0,i.jsx)("option",{value:"hybrid",children:"Hybride"})]}),(0,i.jsx)("button",{onClick:()=>H(!0),className:"px-3 py-2 midnight-blue-btn rounded-md font-semibold shadow-sm transition text-sm",title:"Afficher la carte en plein \xe9cran",children:"Plein \xe9cran"})]})]}),(0,i.jsx)("div",{style:{height:"600px",width:"100%"},children:(0,i.jsx)(m.A,{sieges:em,onSiegeClick:eu,mapStyle:B,style:{height:"100%",minHeight:400},center:[-18.7669,46.8691]})})]})]}):(0,i.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,i.jsx)("div",{className:"flex justify-end mb-2",children:(0,i.jsxs)("button",{onClick:()=>k(!0),className:"px-3 py-2 rounded-md border midnight-blue-border bg-white midnight-blue-text hover:bg-blue-50 flex items-center gap-2 shadow-sm transition font-semibold text-sm",children:[(0,i.jsx)(p.A,{size:16}),(0,i.jsx)("span",{className:"hidden sm:inline",children:"Voir la carte"}),(0,i.jsx)("span",{className:"sm:hidden",children:"Carte"})]})}),(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,i.jsx)(P.b,{columns:ev,data:eh,filterKey:"nom",filterPlaceholder:"Rechercher par nom...",actions:ey}),(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-b-2xl border-t border-blue-100",children:[(0,i.jsxs)("div",{className:"text-sm text-blue-900 font-semibold",children:["Page ",D," sur ",eg]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(M.$,{variant:"outline",size:"sm",disabled:1===D,onClick:()=>T(D-1),className:"flex items-center gap-1",children:[(0,i.jsx)(b.A,{size:14})," ",(0,i.jsx)("span",{className:"hidden sm:inline",children:"Pr\xe9c\xe9dent"})]}),(0,i.jsxs)(M.$,{variant:"outline",size:"sm",disabled:D===eg,onClick:()=>T(D+1),className:"flex items-center gap-1",children:[(0,i.jsx)("span",{className:"hidden sm:inline",children:"Suivant"})," ",(0,i.jsx)(j.A,{size:14})]})]})]})]})]}),(0,i.jsx)(A,{open:Q,onClose:()=>{X(!1),U(null)},initialData:O,mode:O?"edit":"add",siegeId:O?O.id:null,onSuccess:()=>{X(!1),U(null),ec()}}),E&&(0,i.jsx)("div",{className:"fixed inset-0 z-50 bg-white bg-opacity-95 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"w-full h-full flex flex-col bg-white rounded-none shadow-none relative",children:[(0,i.jsx)(M.$,{onClick:()=>H(!1),className:"absolute top-4 right-4 z-50 px-4 py-2 bg-gray-700 text-white rounded-xl shadow-lg hover:bg-gray-900 font-bold transition",title:"Fermer la carte",children:"Fermer la carte"}),(0,i.jsxs)("div",{className:"p-4 border-b",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Carte des locaux"}),(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:[em.length," local",1!==em.length?"s":""," affich\xe9",1!==em.length?"s":""," sur la carte"]})]}),(0,i.jsx)("div",{style:{flex:1,minHeight:0,minWidth:0},children:(0,i.jsx)(m.A,{sieges:em,onSiegeClick:eu,mapStyle:B,style:{height:"100%",minHeight:400},center:[-18.7669,46.8691]})})]})}),J&&(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full p-6 relative",children:[(0,i.jsx)(M.$,{onClick:()=>K(!1),className:"absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-xl font-bold",title:"Fermer",children:"\xd7"}),(0,i.jsx)(v,{onImportSuccess:()=>{K(!1),ec()}})]})}),Y&&ee&&(0,i.jsx)(z.A,{siege:ee,onClose:()=>{Z(!1),et(null)}}),(0,i.jsx)(S.A,{open:es,title:"Confirmer la suppression",description:er?"\xcates-vous s\xfbr de vouloir supprimer le local \xab ".concat(er.nom," \xbb ? Cette action est irr\xe9versible."):"",confirmLabel:en?"Suppression...":"Supprimer",cancelLabel:"Annuler",onCancel:()=>{ei(!1),el(null)},onConfirm:ej,loading:en,variant:"destructive"})]})})}},6231:(e,t,s)=>{Promise.resolve().then(s.bind(s,4025))}},e=>{var t=t=>e(e.s=t);e.O(0,[2046,9484,1761,2871,8916,1929,9516,59,9547,6944,6800,554,1947,6358,931,8441,1684,7358],()=>t(6231)),_N_E=e.O()}]);