"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5005],{2732:(e,s,t)=>{t.d(s,{A:()=>j});var r=t(5155),a=t(9137),o=t.n(a),n=t(2115),l=t(3363),i=t(2919),c=t(8749),d=t(2657),m=t(8136),u=t(1007),f=t(3504),x=t(8883),h=t(7550),p=t(2138);let g=e=>{let{id:s,name:t,value:a,onChange:o,placeholder:n,label:l,showPassword:m,onTogglePassword:u}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(i.A,{className:"w-4 h-4"})," ",l," *"]})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{id:s,name:t,type:m?"text":"password",required:!0,value:a,onChange:o,className:"modern-input pr-10",placeholder:n}),(0,r.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors",onClick:u,children:m?(0,r.jsx)(c.A,{className:"h-5 w-5"}):(0,r.jsx)(d.A,{className:"h-5 w-5"})})]})]})};function j(e){let{onLogin:s,onRegister:t,loading:a,mode:i}=e,[c]=(0,n.useState)(!i||"login"===i),[d,j]=(0,n.useState)(0),[b,w]=(0,n.useState)({email:"",password:"",confirmPassword:"",abreviation:"",nomInstitution:"",nomProjets:[],role:"membre"}),[v,N]=(0,n.useState)(""),[y,C]=(0,n.useState)(!1),[k,P]=(0,n.useState)(!1),[S,A]=(0,n.useState)(!1),{showToast:E,ToastContainer:I}=(0,l.d)(),T=e=>{let{name:s,value:t}=e.target;w(e=>({...e,[s]:t}))},D=e=>{w(s=>({...s,nomProjets:s.nomProjets.filter(s=>s!==e)}))},M=async e=>{if(e.preventDefault(),c){if(!b.email||!b.password)return void E("Veuillez remplir tous les champs obligatoires","error")}else{if(!b.email||!b.password||!b.confirmPassword||!b.abreviation||!b.nomInstitution)return void E("Veuillez remplir tous les champs obligatoires","error");if(b.password!==b.confirmPassword)return void E("Les mots de passe ne correspondent pas","error");if(b.password.length<6)return void E("Le mot de passe doit contenir au moins 6 caract\xe8res","error")}C(!0);try{c?(await s({email:b.email,password:b.password}),E("Connexion r\xe9ussie !","success")):(await t({email:b.email,password:b.password,abreviation:b.abreviation,nomInstitution:b.nomInstitution,nomProjet:b.nomProjets.join(", "),role:"membre"}),E("Inscription r\xe9ussie !","success"))}catch(e){E(e.message,"error")}finally{C(!1)}},z=[{label:"Institution",content:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"nomInstitution",className:"block text-sm font-medium text-gray-700 mb-1",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"w-4 h-4"})," Nom de l'institution *"]})}),(0,r.jsx)("input",{id:"nomInstitution",name:"nomInstitution",type:"text",required:!0,value:b.nomInstitution,onChange:T,className:"modern-input",placeholder:"Nom de l'institution"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"abreviation",className:"block text-sm font-medium text-gray-700 mb-1",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"w-4 h-4"})," Abr\xe9viation *"]})}),(0,r.jsx)("input",{id:"abreviation",name:"abreviation",type:"text",required:!0,value:b.abreviation,onChange:T,className:"modern-input",placeholder:"Abr\xe9viation (ex: JD)"})]})]})},{label:"Projets",content:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"nomProjet",className:"block text-sm font-medium text-gray-700 mb-1",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(f.A,{className:"w-4 h-4"})," Projets rattach\xe9s"]})}),(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)("input",{id:"nomProjet",name:"nomProjet",type:"text",value:v,onChange:e=>N(e.target.value),className:"modern-input",placeholder:"Ajouter un projet et appuyer sur +"}),(0,r.jsx)("button",{type:"button",onClick:e=>{e.preventDefault();let s=v.trim();s&&!b.nomProjets.includes(s)&&(w(e=>({...e,nomProjets:[...e.nomProjets,s]})),N(""))},className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold",children:"+"})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:b.nomProjets.map((e,s)=>(0,r.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs flex items-center",children:[e,(0,r.jsx)("button",{type:"button",onClick:()=>D(e),className:"ml-1 text-blue-800 hover:text-red-600",children:"\xd7"})]},s))})]})},{label:"Compte",content:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"w-4 h-4"})," Email *"]})}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:b.email,onChange:T,className:"modern-input",placeholder:"Email"})]}),(0,r.jsx)(g,{id:"password",name:"password",value:b.password,onChange:T,placeholder:"Mot de passe",label:"Mot de passe",showPassword:k,onTogglePassword:()=>P(!k)}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(g,{id:"confirmPassword",name:"confirmPassword",value:b.confirmPassword,onChange:T,placeholder:"Confirmer le mot de passe",label:"Confirmer le mot de passe",showPassword:S,onTogglePassword:()=>A(!S)})})]})}],R=i?"login"===i:c;return(0,r.jsxs)("div",{className:"jsx-f6c81dccf4169f79 min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-100 via-white to-blue-200 py-12 px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)(I,{className:"jsx-f6c81dccf4169f79"}),(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 w-full max-w-lg",children:(0,r.jsxs)("div",{className:"jsx-f6c81dccf4169f79 bg-white rounded-2xl shadow-2xl p-8 relative",children:[(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 mx-auto h-14 w-14 flex items-center justify-center rounded-full bg-blue-50 mb-4",children:(0,r.jsx)("svg",{style:{color:"rgb(0,70,144)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-f6c81dccf4169f79 h-8 w-8",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z",className:"jsx-f6c81dccf4169f79"})})}),(0,r.jsxs)("h2",{className:"jsx-f6c81dccf4169f79 text-center text-3xl font-extrabold text-gray-900 leading-tight",children:[(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79",children:R?"Connexion":"Inscription"}),(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 text-lg",children:"\xe0"}),(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79",children:"Alliance-Agroforesterie"})]}),!R&&(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 flex items-center justify-center gap-2 mt-6 mb-2",children:z.map((e,s)=>(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 "+"h-2 w-2 md:w-8 rounded-full transition-all duration-300 ".concat(s<=d?"bg-blue-700":"bg-blue-200"," ").concat(s===d?"md:w-12":"")},e.label))}),(0,r.jsxs)("form",{onSubmit:M,className:"jsx-f6c81dccf4169f79 mt-4 space-y-6",children:[(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 rounded-md shadow-sm flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:R?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"jsx-f6c81dccf4169f79",children:[(0,r.jsx)("label",{htmlFor:"email",className:"jsx-f6c81dccf4169f79 block text-sm font-medium text-gray-700 mb-1",children:(0,r.jsxs)("span",{className:"jsx-f6c81dccf4169f79 flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"w-4 h-4"})," Email *"]})}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:b.email,onChange:T,placeholder:"Email",className:"jsx-f6c81dccf4169f79 modern-input"})]}),(0,r.jsx)(g,{id:"password",name:"password",value:b.password,onChange:T,placeholder:"Mot de passe",label:"Mot de passe",showPassword:k,onTogglePassword:()=>P(!k)})]}):z[d].content}),!R&&(0,r.jsxs)("div",{className:"jsx-f6c81dccf4169f79 flex justify-between items-center mt-2",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>j(e=>Math.max(0,e-1)),disabled:0===d,className:"jsx-f6c81dccf4169f79 "+"flex items-center gap-2 px-4 py-2 rounded-md font-medium ".concat(0===d?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[(0,r.jsx)(h.A,{className:"w-4 h-4"})," Pr\xe9c\xe9dent"]}),d<z.length-1?(0,r.jsxs)("button",{type:"button",onClick:()=>j(e=>Math.min(z.length-1,e+1)),disabled:!(c||(0===d?b.nomInstitution.trim()&&b.abreviation.trim():1===d||2!==d||b.email.trim()&&b.password.trim()&&b.confirmPassword.trim())),className:"jsx-f6c81dccf4169f79 flex items-center gap-2 px-4 py-2 rounded-md bg-blue-700 text-white hover:bg-blue-800 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:["Suivant ",(0,r.jsx)(p.A,{className:"w-4 h-4"})]}):(0,r.jsx)("button",{type:"submit",disabled:y||a,className:"jsx-f6c81dccf4169f79 group relative flex items-center gap-2 justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60",children:y||a?(0,r.jsxs)("span",{className:"jsx-f6c81dccf4169f79 flex items-center justify-center",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"jsx-f6c81dccf4169f79 animate-spin h-5 w-5 text-white mr-2",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"jsx-f6c81dccf4169f79 opacity-25"}),(0,r.jsx)("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8v8z",className:"jsx-f6c81dccf4169f79 opacity-75"})]}),"Inscription..."]}):"Cr\xe9er un compte"})]}),R&&(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79",children:(0,r.jsx)("button",{type:"submit",disabled:y||a,className:"jsx-f6c81dccf4169f79 group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60",children:y||a?(0,r.jsxs)("span",{className:"jsx-f6c81dccf4169f79 flex items-center justify-center",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"jsx-f6c81dccf4169f79 animate-spin h-5 w-5 text-white mr-2",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"jsx-f6c81dccf4169f79 opacity-25"}),(0,r.jsx)("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8v8z",className:"jsx-f6c81dccf4169f79 opacity-75"})]}),"Connexion..."]}):"Se connecter"})})]}),(0,r.jsx)("div",{className:"jsx-f6c81dccf4169f79 text-center mt-4",children:R?(0,r.jsx)("a",{href:"/register",className:"jsx-f6c81dccf4169f79 text-blue-700 hover:underline text-sm font-medium",children:"Pas encore de compte ? S'inscrire"}):(0,r.jsx)("a",{href:"/login",className:"jsx-f6c81dccf4169f79 text-blue-700 hover:underline text-sm font-medium",children:"D\xe9j\xe0 inscrit ? Se connecter"})})]})}),(0,r.jsx)(o(),{id:"f6c81dccf4169f79",children:".modern-input{@apply appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-base transition-all duration-200 shadow-sm;}"})]})}},3363:(e,s,t)=>{t.d(s,{A:()=>n,d:()=>l});var r=t(5155),a=t(2115);let o=e=>{let{message:s,type:t="info",duration:o=3e3,onClose:n}=e,[l,i]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let e=setTimeout(()=>{i(!1),setTimeout(()=>n(),300)},o);return()=>clearTimeout(e)},[o,n]),l)?(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ".concat((()=>{switch(t){case"success":return"bg-green-500 text-white";case"error":return"bg-red-500 text-white";case"warning":return"bg-yellow-500 text-black";default:return"bg-blue-500 text-white"}})()),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:s}),(0,r.jsx)("button",{onClick:()=>{i(!1),setTimeout(()=>n(),300)},className:"ml-4 text-white hover:text-gray-200",children:"\xd7"})]})}):null},n=o;function l(){let[e,s]=(0,a.useState)([]),t=e=>{s(s=>s.filter(s=>s.id!==e))};return{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,a=Date.now(),o={id:a,message:e,type:t,duration:r};return s(e=>[...e,o]),a},removeToast:t,ToastContainer:()=>(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>(0,r.jsx)(o,{message:e.message,type:e.type,duration:e.duration,onClose:()=>t(e.id)},e.id))})}}},6254:(e,s,t)=>{t.d(s,{AuthProvider:()=>i,h:()=>c});var r=t(5155),a=t(2115);t(9624);var o=t(5695),n=t(5384);let l=(0,a.createContext)();function i(e){let{children:s}=e,[t,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!0),[f,x]=(0,a.useState)(!1),h=(0,o.useRouter)();(0,a.useEffect)(()=>{let e=n.Ep.getToken(),s=n.Ep.getUser(),t=window.location.pathname;e&&s&&!n.Ep.isTokenExpired(e)?(i(s),d(!0)):(i(null),d(!1),n.Ep.clearAuthData(),["/","/login","/register","/pepinieres-globales","/parcelles-globales","/sieges-globaux"].includes(t)||h.push("/login")),u(!1)},[h]);let p=async()=>{x(!0),await new Promise(e=>setTimeout(e,700)),n.Ep.clearAuthData(),i(null),d(!1),x(!1);let e=window.location.pathname;"/"!==e&&"/login"!==e&&"/register"!==e&&h.push("/")};return(0,r.jsx)(l.Provider,{value:{user:t,isAuthenticated:c,isLoading:m,isLoggingOut:f,login:(e,s)=>{if("string"!=typeof s||!s.trim())return void console.error("Tentative de login avec un token invalide:",s);n.Ep.setAuthData(s,e),i(e),d(!0)},logout:p},children:s})}function c(){return(0,a.useContext)(l)}},9624:(e,s,t)=>{t.d(s,{A:()=>f});var r=t(8592),a=t(524),o=t(2641),n=t(4076),l=t(1957),i=t(883),c=t(9159);let d=(0,i.A)({uri:"".concat("https://api.allianceagroforesterie.mg","/graphql/")}),m=(0,n.o)((e,s)=>{let{headers:t}=s,r=localStorage.getItem("token");if(r)try{let e=(0,c.s)(r),s=Date.now()/1e3;if(e.exp<s)return localStorage.removeItem("token"),localStorage.removeItem("user"),{headers:{...t,authorization:""}}}catch(e){return console.error("Apollo Client - Erreur lors du d\xe9codage du token:",e),localStorage.removeItem("token"),localStorage.removeItem("user"),{headers:{...t,authorization:""}}}return{headers:{...t,authorization:r?"JWT ".concat(r):""}}}),u=(0,l.S)(e=>{let{graphQLErrors:s,networkError:t,operation:r,forward:a}=e;s&&s.forEach(e=>{let{message:s,locations:t,path:r,extensions:a}=e;console.error("[GraphQL error]: Message: ".concat(s,", Location: ").concat(t,", Path: ").concat(r)),((null==a?void 0:a.code)==="UNAUTHENTICATED"||s.includes("authentication")||s.includes("decoding signature")||s.includes("token")||s.includes("expired"))&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/errors/401"),((null==a?void 0:a.code)==="BAD_REQUEST"||s.includes("bad request")||s.includes("invalid"))&&(window.location.href="/errors/400"),((null==a?void 0:a.code)==="NOT_FOUND"||s.includes("not found"))&&(window.location.href="/errors/404"),((null==a?void 0:a.code)==="INTERNAL_SERVER_ERROR"||s.includes("server error"))&&(window.location.href="/errors/500")}),t&&(console.error("[Network error]: ".concat(t)),400===t.statusCode?window.location.href="/errors/400":401===t.statusCode?(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/errors/401"):404===t.statusCode?window.location.href="/errors/404":500===t.statusCode&&(window.location.href="/errors/500"))}),f=new r.R({link:(0,a.H)([u,m,d]),cache:new o.D,defaultOptions:{watchQuery:{errorPolicy:"all"},query:{errorPolicy:"all"}}})}}]);