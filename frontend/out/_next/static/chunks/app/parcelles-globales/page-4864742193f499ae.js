(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1246],{1492:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(9946).A)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]])},1804:(e,t,r)=>{"use strict";function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"export.csv";if(!e||!e.length)return;let r=[],l=Object.keys(e[0]);for(let t of(r.push(l.join(",")),e)){let e=l.map(e=>{var r;let l=null!=(r=t[e])?r:"";return'"'.concat(String(l).replace(/"/g,'""'),'"')});r.push(e.join(","))}let s=new Blob([r.join("\n")],{type:"text/csv"}),n=window.URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=t,i.click(),window.URL.revokeObjectURL(n)}r.d(t,{G:()=>l})},2676:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var l=r(5155),s=r(2115),n=r(5384);let i=e=>{let{users:t=[],selectedMembers:r=[],onFilterChange:i}=e,[a,o]=(0,s.useState)(!1),c=Array.isArray(t)?t:[],d=Array.isArray(r)?r:[],u=e=>{i(d.includes(e)?d.filter(t=>t!==e):[...d,e])},m=d.length,h=c.length;return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{onClick:()=>o(!a),className:"flex items-center justify-between w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,l.jsx)("span",{children:0===m||m===h?"Tous les institutions":"".concat(m," institution(s) s\xe9lectionn\xe9e(s)")}),(0,l.jsx)("svg",{className:"w-5 h-5 ml-2 transition-transform ".concat(a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,l.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:(0,l.jsxs)("div",{className:"p-2",children:[(0,l.jsxs)("label",{className:"flex items-center px-3 py-2 text-sm hover:bg-gray-100 rounded cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:m===h&&h>0,onChange:()=>{d.length===c.length?i([]):i(c.map(e=>e.id))},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,l.jsxs)("span",{className:"ml-3 font-medium text-gray-900",children:["S\xe9lectionner tout (",h,")"]})]}),(0,l.jsx)("div",{className:"border-t border-gray-200 my-2"}),c.map(e=>(0,l.jsxs)("label",{className:"flex items-center px-3 py-2 text-sm hover:bg-gray-100 rounded cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:d.includes(e.id),onChange:()=>u(e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,l.jsxs)("div",{className:"ml-3 flex items-center",children:[e.logo&&(0,l.jsx)("img",{src:(0,n.D1)(e.logo),alt:"Logo",className:"w-6 h-6 rounded-full mr-2"}),(0,l.jsxs)("span",{className:"text-gray-900",children:[e.firstName," ",e.lastName]}),(0,l.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:e.email})]})]},e.id))]})}),a&&(0,l.jsx)("div",{className:"fixed inset-0 z-0",onClick:()=>o(!1)})]})}},2859:(e,t,r)=>{Promise.resolve().then(r.bind(r,8110))},5623:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let l=(0,r(9946).A)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},8110:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var l=r(5155),s=r(2115),n=r(1929),i=r(3593),a=r(5369),o=r(1492),c=r(5623),d=r(183),u=r(7860),m=r(5384);let h=(e,t)=>[{accessorKey:"Nom site de r\xe9f\xe9rence",header:e=>{let{column:t}=e;return(0,l.jsx)("div",{className:"text-center",children:(0,l.jsxs)(d.$,{variant:"ghost",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Nom site de r\xe9f\xe9rence ",(0,l.jsx)(o.A,{className:"ml-2 h-4 w-4"})]})})},cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"text-center",children:t.original.nom})}},{id:"Institutions",header:"Institutions",cell:e=>{let{row:t}=e,r=t.original.user;return(0,l.jsxs)("div",{className:"flex items-center",children:[(null==r?void 0:r.logo)&&(0,l.jsx)("img",{src:(0,m.D1)(r.logo),alt:"Logo",className:"w-6 h-6 rounded-full mr-2"}),(0,l.jsx)("div",{children:(0,l.jsx)("div",{className:"text-sm font-medium text-gray-900",children:null==r?void 0:r.nomInstitution})})]})}},{accessorKey:"Personne R\xe9f\xe9rente",header:"Personne r\xe9f\xe9rente",cell:e=>{let{row:t}=e,r=t.original;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-medium",children:r.nomPersonneReferente||"-"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:r.poste||"-"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:r.telephone||"-"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:r.email||"-"})]})}},{accessorKey:"Projet rattach\xe9",header:()=>(0,l.jsx)("div",{className:"text-center",children:"Projet rattach\xe9"}),cell:e=>{let{row:t}=e;return(0,l.jsx)("div",{className:"text-center",children:t.original.nomProjet||"-"})}},{accessorKey:"Pratiques",header:()=>(0,l.jsx)("div",{className:"text-center",children:"Pratiques"}),cell:e=>{let{row:t}=e,r=t.original.pratique?t.original.pratique.split(","):[];return r.length?(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)("ul",{className:"text-center inline-block max-w-xs",children:r.map((e,t)=>{let r=e.trim(),s=r.length>30?r.slice(0,30)+"...":r;return(0,l.jsx)("li",{title:r,className:"truncate overflow-hidden whitespace-nowrap",children:s},t)})})}):(0,l.jsx)("div",{className:"text-center",children:"-"})}},{id:"actions",header:"Actions",cell:r=>{let{row:s}=r;return(0,l.jsxs)(u.rI,{children:[(0,l.jsx)(u.ty,{asChild:!0,children:(0,l.jsxs)(d.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,l.jsx)("span",{className:"sr-only",children:"Ouvrir le menu"}),(0,l.jsx)(c.A,{className:"h-4 w-4"})]})}),(0,l.jsxs)(u.SQ,{align:"end",children:[(0,l.jsx)(u.lp,{children:"Actions"}),(0,l.jsx)(u._2,{onClick:()=>e(s.original),children:"Voir d\xe9tails"}),(0,l.jsx)(u._2,{onClick:()=>t(s.original),children:"Voir sur la carte"}),(0,l.jsx)(u.mB,{})]})]})},enableSorting:!1,enableHiding:!1}];var x=r(6927),g=r(2676);let p=[{value:"structure_brise_vent",label:"Structure Brise-vent"},{value:"structure_pare_feu",label:"Structure Pare feu"},{value:"structures_antierosives",label:"Structures anti\xe9rosives"},{value:"structure_cultures_couloir",label:"Structure Cultures en Couloir/all\xe9e"},{value:"pratiques_taillage_coupe",label:"Pratiques de taillage, coupe et application engrais verts"},{value:"pratiques_couverture_sol",label:"Pratiques couverture du sol"},{value:"pratiques_conservation_eau",label:"Pratiques/structures conservation d'eau"},{value:"systeme_multi_etage",label:"Syst\xe8me multi-\xe9tage diversifi\xe9"},{value:"arbres_autochtones",label:"Arbres Autochtones"},{value:"production_epices",label:"Production \xe9pices"},{value:"production_bois_energie",label:"Production Bois \xe9nergie"},{value:"production_fruit",label:"Production fruit"},{value:"integration_cultures_vivrieres",label:"Int\xe9gration cultures vivri\xe8res"},{value:"integration_elevage",label:",Int\xe9gration d'\xe9levage"}];function b(e){let{selectedPratiques:t=[],onFilterChange:r}=e,[n,i]=(0,s.useState)(!1),a=e=>{r(t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{onClick:()=>i(!n),className:"flex items-center justify-between w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,l.jsx)("span",{children:0===t.length||t.length===p.length?"Toutes les pratiques":"".concat(t.length," pratique(s) s\xe9lectionn\xe9e(s)")}),(0,l.jsx)("svg",{className:"w-5 h-5 ml-2 transition-transform ".concat(n?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&(0,l.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:(0,l.jsxs)("div",{className:"p-2",children:[(0,l.jsxs)("label",{className:"flex items-center mb-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:t.length===p.length,onChange:()=>{t.length===p.length?r([]):r(p.map(e=>e.value))},className:"mr-2"}),"Toutes les pratiques"]}),p.map(e=>(0,l.jsxs)("label",{className:"flex items-center mb-1",children:[(0,l.jsx)("input",{type:"checkbox",checked:t.includes(e.value),onChange:()=>a(e.value),className:"mr-2"}),e.label]},e.value))]})})]})}var f=r(1804),v=r(4664),j=r(4203);let N={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},y={background:"white",borderRadius:"8px",padding:"24px",width:"800px",minWidth:"350px",height:"600px",minHeight:"400px",maxWidth:"95vw",maxHeight:"95vh",display:"flex",flexDirection:"column"};function w(e){let{open:t,onClose:r,parcelle:n}=e,[i,a]=s.useState("street");return t&&n?(0,l.jsx)("div",{style:N,children:(0,l.jsxs)("div",{style:y,children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h2",{className:"text-lg font-bold",children:"Voir sur la carte"}),(0,l.jsx)("button",{onClick:r,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"Fermer"})]}),(0,l.jsxs)("div",{className:"mb-2 flex gap-2 items-center",children:[(0,l.jsx)("label",{htmlFor:"map-style",className:"font-medium",children:"Style de carte :"}),(0,l.jsxs)("select",{id:"map-style",value:i,onChange:e=>a(e.target.value),className:"px-2 py-1 border rounded",children:[(0,l.jsx)("option",{value:"street",children:"Carte routi\xe8re"}),(0,l.jsx)("option",{value:"satellite",children:"Satellite"}),(0,l.jsx)("option",{value:"hybrid",children:"Hybride"})]})]}),(0,l.jsx)("div",{style:{flex:1,minHeight:0},children:(0,l.jsx)(j.A,{parcelles:[n],style:{height:"100%",width:"100%"},mapStyle:i})})]})}):null}function k(){let[e,t]=(0,s.useState)([]),[r,o]=(0,s.useState)([]),[c,u]=(0,s.useState)([]),[m,p]=(0,s.useState)(""),{showError:j}=(0,a.d)(),[N,y]=(0,s.useState)({open:!1,parcelle:null}),[k,C]=(0,s.useState)({open:!1,parcelle:null}),[S,_]=(0,s.useState)(1),[P,E]=(0,s.useState)(10);(0,s.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      :root {\n        --midnight-blue: rgb(0,70,144);\n      }\n      .midnight-blue-bg {\n        background-color: var(--midnight-blue) !important;\n        color: #fff !important;\n      }\n      .midnight-blue-text {\n        color: var(--midnight-blue) !important;\n      }\n      .midnight-blue-border {\n        border-color: var(--midnight-blue) !important;\n      }\n      .midnight-blue-btn {\n        background-color: var(--midnight-blue) !important;\n        color: #fff !important;\n        border: 1px solid var(--midnight-blue) !important;\n      }\n      .midnight-blue-btn:hover {\n        background-color: #003366 !important;\n        color: #fff !important;\n      }\n      .pagination-btn {\n        padding: 8px 12px;\n        margin: 0 2px;\n        border: 1px solid #d1d5db;\n        background: white;\n        color: #374151;\n        border-radius: 6px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      .pagination-btn:hover {\n        background-color: #f3f4f6;\n        border-color: var(--midnight-blue);\n      }\n      .pagination-btn.active {\n        background-color: var(--midnight-blue);\n        color: white;\n        border-color: var(--midnight-blue);\n      }\n      .pagination-btn:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n      .pagination-btn:disabled:hover {\n        background: white;\n        border-color: #d1d5db;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]);let{data:A,loading:I,error:R}=(0,n.IT)(i.xh),{data:O,loading:T,error:q}=(0,n.IT)(i.em);(0,s.useEffect)(()=>{if(null==A?void 0:A.allParcelles){let t=A.allParcelles;if(e.length>0&&(t=t.filter(t=>e.includes(t.user.id))),c.length>0&&(t=t.filter(e=>{if(!e.pratique)return!1;let t=e.pratique.split(",").map(e=>e.trim().toLowerCase().replace(/\s+/g,""));return c.some(e=>{let r=e.toLowerCase().replace(/\s+/g,"");return t.some(e=>e.includes(r)||r.includes(e))})})),""!==m.trim()){let e=m.toLowerCase();t=t.filter(t=>[t.nom,t.nomProjet,t.pratique,t.nomPersonneReferente,t.poste,t.telephone,t.email].some(t=>(t||"").toString().toLowerCase().includes(e)))}o(t),_(1)}},[A,e,c,m]);let L=r.length,F=Math.ceil(L/P),D=(S-1)*P,M=D+P,U=r.slice(D,M);if(R&&(j("Erreur lors du chargement des parcelles"),console.error("Parcelles error:",R)),q&&(j("Erreur lors du chargement des utilisateurs"),console.error("Users error:",q)),I||T)return(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})});let H=e=>{_(e)};return(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold midnight-blue-text mb-2",children:"Liste des sites de r\xe9f\xe9rence"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Consultez tous les sites de r\xe9f\xe9rence tous les institution de la plateforme."})]}),(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex-1 mb-4 lg:mb-0",children:[(0,l.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Filtrer par membre"}),(0,l.jsx)(g.A,{users:(null==O?void 0:O.allUsers)||[],selectedMembers:e,onFilterChange:e=>{t(e)}})]}),(0,l.jsxs)("div",{className:"flex-1 mb-4 lg:mb-0",children:[(0,l.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Filtrer par pratique"}),(0,l.jsx)(b,{selectedPratiques:c,onFilterChange:e=>{u(e)}})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Recherche globale"}),(0,l.jsx)("input",{type:"text",value:m,onChange:e=>{p(e.target.value)},placeholder:"Rechercher dans toutes les colonnes...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,l.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("h3",{className:"text-lg font-medium midnight-blue-text",children:["Sites de r\xe9f\xe9rence (",L,")"]}),e.length>0&&(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:["Filtr\xe9 par ",e.length," membre(s)"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("label",{htmlFor:"itemsPerPage",className:"text-sm text-gray-600",children:"Afficher:"}),(0,l.jsxs)("select",{id:"itemsPerPage",value:P,onChange:e=>{E(parseInt(e.target.value)),_(1)},className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,l.jsx)("option",{value:10,children:"10"}),(0,l.jsx)("option",{value:25,children:"25"}),(0,l.jsx)("option",{value:50,children:"50"}),(0,l.jsx)("option",{value:100,children:"100"})]}),(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"lignes"})]}),(0,l.jsx)(d.$,{className:"midnight-blue-btn px-4 py-2 rounded-md font-bold text-sm",onClick:()=>{let e=new Date().toISOString().slice(0,10),t=r.map(e=>{var t,r;return{NOM:e.nom||"",INSTITUTION:(null==(t=e.user)?void 0:t.nomInstitution)||"",ABREVIATION:(null==(r=e.user)?void 0:r.abreviation)||"",PROJET_RATTACHE:e.nomProjet||"",NOM_PERSONNE_REFERENTE:e.nomPersonneReferente||"",POSTE:e.poste||"",TELEPHONE:e.telephone||"",EMAIL:e.email||"",SUPERFICIE:e.superficie||"",PRATIQUE:e.pratique||"",GEOJSON:JSON.stringify(e.geojson)||"",DESCRIPTION:e.description||"",DATE_CREATION:e.createdAt?new Date(e.createdAt).toLocaleDateString("fr-FR"):"",DERNIERE_MODIFICATION:e.updatedAt?new Date(e.updatedAt).toLocaleDateString("fr-FR"):""}});(0,f.G)(t,"Sites_de_reference_export_".concat(e,".csv"))},disabled:0===r.length,children:"Exporter CSV"})]})]})}),(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)(x.b,{columns:h(e=>{y({open:!0,parcelle:e})},e=>{C({open:!0,parcelle:e})}),data:U})}),F>1&&(0,l.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:["Affichage de ",D+1," \xe0 ",Math.min(M,L)," sur ",L," r\xe9sultats"]}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("button",{onClick:()=>H(S-1),disabled:1===S,className:"pagination-btn",children:"← Pr\xe9c\xe9dent"}),(()=>{let e=[];if(F<=5)for(let t=1;t<=F;t++)e.push(t);else if(S<=3){for(let t=1;t<=4;t++)e.push(t);e.push("..."),e.push(F)}else if(S>=F-2){e.push(1),e.push("...");for(let t=F-3;t<=F;t++)e.push(t)}else{e.push(1),e.push("...");for(let t=S-1;t<=S+1;t++)e.push(t);e.push("..."),e.push(F)}return e})().map((e,t)=>(0,l.jsx)("button",{onClick:()=>"number"==typeof e?H(e):null,disabled:"..."===e,className:"pagination-btn ".concat(S===e?"active":""),children:e},t)),(0,l.jsx)("button",{onClick:()=>H(S+1),disabled:S===F,className:"pagination-btn",children:"Suivant →"})]})]})})]}),N.open&&N.parcelle&&(0,l.jsx)(v.A,{parcelle:N.parcelle,onClose:()=>{y({open:!1,parcelle:null})}}),k.open&&k.parcelle&&(0,l.jsx)(w,{open:k.open,parcelle:k.parcelle,onClose:()=>{C({open:!1,parcelle:null})}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2046,1761,2871,8916,1929,59,9547,6800,554,4664,4203,8441,1684,7358],()=>t(2859)),_N_E=e.O()}]);