(()=>{var e={};e.id=246,e.ids=[246],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3868:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var t=r(65239),l=r(48088),a=r(88170),i=r.n(a),n=r(30893),o={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(s,o);let c={children:["",{children:["parcelles-globales",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,54884)),"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\parcelles-globales\\page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,75535)),"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(r.bind(r,28069)),"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\not-found.js"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\parcelles-globales\\page.js"],u={require:r,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:l.RouteKind.APP_PAGE,page:"/parcelles-globales/page",pathname:"/parcelles-globales",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},10788:(e,s,r)=>{Promise.resolve().then(r.bind(r,67235))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29348:(e,s,r)=>{Promise.resolve().then(r.bind(r,54884))},33873:e=>{"use strict";e.exports=require("path")},54884:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\User\\\\Videos\\\\Nouveau dossier\\\\geomap\\\\geo-map-\\\\frontend\\\\src\\\\app\\\\parcelles-globales\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\User\\Videos\\Nouveau dossier\\geomap\\geo-map-\\frontend\\src\\app\\parcelles-globales\\page.js","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67235:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>P});var t=r(60687),l=r(43210),a=r.n(l),i=r(8829),n=r(48443),o=r(92049),c=r(54220),d=r(93661),u=r(76717),m=r(92120),p=r(65222);let x=(e,s)=>[{accessorKey:"Nom site de r\xe9f\xe9rence",header:({column:e})=>(0,t.jsx)("div",{className:"text-center",children:(0,t.jsxs)(u.$,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),children:["Nom site de r\xe9f\xe9rence ",(0,t.jsx)(c.A,{className:"ml-2 h-4 w-4"})]})}),cell:({row:e})=>(0,t.jsx)("div",{className:"text-center",children:e.original.nom})},{id:"Institutions",header:"Institutions",cell:({row:e})=>{let s=e.original.user;return(0,t.jsxs)("div",{className:"flex items-center",children:[s?.logo&&(0,t.jsx)("img",{src:(0,p.D1)(s.logo),alt:"Logo",className:"w-6 h-6 rounded-full mr-2"}),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s?.nomInstitution})})]})}},{accessorKey:"Personne R\xe9f\xe9rente",header:"Personne r\xe9f\xe9rente",cell:({row:e})=>{let s=e.original;return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:s.nomPersonneReferente||"-"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:s.poste||"-"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:s.telephone||"-"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:s.email||"-"})]})}},{accessorKey:"Projet rattach\xe9",header:()=>(0,t.jsx)("div",{className:"text-center",children:"Projet rattach\xe9"}),cell:({row:e})=>(0,t.jsx)("div",{className:"text-center",children:e.original.nomProjet||"-"})},{accessorKey:"Pratiques",header:()=>(0,t.jsx)("div",{className:"text-center",children:"Pratiques"}),cell:({row:e})=>{let s=e.original.pratique?e.original.pratique.split(","):[];return s.length?(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("ul",{className:"text-center inline-block max-w-xs",children:s.map((e,s)=>{let r=e.trim(),l=r.length>30?r.slice(0,30)+"...":r;return(0,t.jsx)("li",{title:r,className:"truncate overflow-hidden whitespace-nowrap",children:l},s)})})}):(0,t.jsx)("div",{className:"text-center",children:"-"})}},{id:"actions",header:"Actions",cell:({row:r})=>(0,t.jsxs)(m.rI,{children:[(0,t.jsx)(m.ty,{asChild:!0,children:(0,t.jsxs)(u.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,t.jsx)("span",{className:"sr-only",children:"Ouvrir le menu"}),(0,t.jsx)(d.A,{className:"h-4 w-4"})]})}),(0,t.jsxs)(m.SQ,{align:"end",children:[(0,t.jsx)(m.lp,{children:"Actions"}),(0,t.jsx)(m._2,{onClick:()=>e(r.original),children:"Voir d\xe9tails"}),(0,t.jsx)(m._2,{onClick:()=>s(r.original),children:"Voir sur la carte"}),(0,t.jsx)(m.mB,{})]})]}),enableSorting:!1,enableHiding:!1}];var h=r(32168),g=r(21426);let v=[{value:"structure_brise_vent",label:"Structure Brise-vent"},{value:"structure_pare_feu",label:"Structure Pare feu"},{value:"structures_antierosives",label:"Structures anti\xe9rosives"},{value:"structure_cultures_couloir",label:"Structure Cultures en Couloir/all\xe9e"},{value:"pratiques_taillage_coupe",label:"Pratiques de taillage, coupe et application engrais verts"},{value:"pratiques_couverture_sol",label:"Pratiques couverture du sol"},{value:"pratiques_conservation_eau",label:"Pratiques/structures conservation d'eau"},{value:"systeme_multi_etage",label:"Syst\xe8me multi-\xe9tage diversifi\xe9"},{value:"arbres_autochtones",label:"Arbres Autochtones"},{value:"production_epices",label:"Production \xe9pices"},{value:"production_bois_energie",label:"Production Bois \xe9nergie"},{value:"production_fruit",label:"Production fruit"},{value:"integration_cultures_vivrieres",label:"Int\xe9gration cultures vivri\xe8res"},{value:"integration_elevage",label:",Int\xe9gration d'\xe9levage"}];function b({selectedPratiques:e=[],onFilterChange:s}){let[r,a]=(0,l.useState)(!1),i=r=>{s(e.includes(r)?e.filter(e=>e!==r):[...e,r])};return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>a(!r),className:"flex items-center justify-between w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,t.jsx)("span",{children:0===e.length||e.length===v.length?"Toutes les pratiques":`${e.length} pratique(s) s\xe9lectionn\xe9e(s)`}),(0,t.jsx)("svg",{className:`w-5 h-5 ml-2 transition-transform ${r?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r&&(0,t.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsxs)("label",{className:"flex items-center mb-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.length===v.length,onChange:()=>{e.length===v.length?s([]):s(v.map(e=>e.value))},className:"mr-2"}),"Toutes les pratiques"]}),v.map(s=>(0,t.jsxs)("label",{className:"flex items-center mb-1",children:[(0,t.jsx)("input",{type:"checkbox",checked:e.includes(s.value),onChange:()=>i(s.value),className:"mr-2"}),s.label]},s.value))]})})]})}var f=r(89252),j=r(94216),N=r(74257);let y={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},_={background:"white",borderRadius:"8px",padding:"24px",width:"800px",minWidth:"350px",height:"600px",minHeight:"400px",maxWidth:"95vw",maxHeight:"95vh",display:"flex",flexDirection:"column"};function w({open:e,onClose:s,parcelle:r}){let[l,i]=a().useState("street");return e&&r?(0,t.jsx)("div",{style:y,children:(0,t.jsxs)("div",{style:_,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:"Voir sur la carte"}),(0,t.jsx)("button",{onClick:s,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"Fermer"})]}),(0,t.jsxs)("div",{className:"mb-2 flex gap-2 items-center",children:[(0,t.jsx)("label",{htmlFor:"map-style",className:"font-medium",children:"Style de carte :"}),(0,t.jsxs)("select",{id:"map-style",value:l,onChange:e=>i(e.target.value),className:"px-2 py-1 border rounded",children:[(0,t.jsx)("option",{value:"street",children:"Carte routi\xe8re"}),(0,t.jsx)("option",{value:"satellite",children:"Satellite"}),(0,t.jsx)("option",{value:"hybrid",children:"Hybride"})]})]}),(0,t.jsx)("div",{style:{flex:1,minHeight:0},children:(0,t.jsx)(N.A,{parcelles:[r],style:{height:"100%",width:"100%"},mapStyle:l})})]})}):null}function P(){let[e,s]=(0,l.useState)([]),[r,a]=(0,l.useState)([]),[c,d]=(0,l.useState)([]),[m,p]=(0,l.useState)(""),{showError:v}=(0,o.d)(),[N,y]=(0,l.useState)({open:!1,parcelle:null}),[_,P]=(0,l.useState)({open:!1,parcelle:null}),[C,S]=(0,l.useState)(1),[E,I]=(0,l.useState)(10),{data:A,loading:k,error:q}=(0,i.IT)(n.xh),{data:R,loading:T,error:O}=(0,i.IT)(n.em),U=r.length,F=Math.ceil(U/E),D=(C-1)*E,M=D+E,V=r.slice(D,M);if(q&&(v("Erreur lors du chargement des parcelles"),console.error("Parcelles error:",q)),O&&(v("Erreur lors du chargement des utilisateurs"),console.error("Users error:",O)),k||T)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})});let L=e=>{S(e)};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold midnight-blue-text mb-2",children:"Liste des sites de r\xe9f\xe9rence"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Consultez tous les sites de r\xe9f\xe9rence tous les institution de la plateforme."})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 mb-4 lg:mb-0",children:[(0,t.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Filtrer par membre"}),(0,t.jsx)(g.A,{users:R?.allUsers||[],selectedMembers:e,onFilterChange:e=>{s(e)}})]}),(0,t.jsxs)("div",{className:"flex-1 mb-4 lg:mb-0",children:[(0,t.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Filtrer par pratique"}),(0,t.jsx)(b,{selectedPratiques:c,onFilterChange:e=>{d(e)}})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Recherche globale"}),(0,t.jsx)("input",{type:"text",value:m,onChange:e=>{p(e.target.value)},placeholder:"Rechercher dans toutes les colonnes...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium midnight-blue-text",children:["Sites de r\xe9f\xe9rence (",U,")"]}),e.length>0&&(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["Filtr\xe9 par ",e.length," membre(s)"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{htmlFor:"itemsPerPage",className:"text-sm text-gray-600",children:"Afficher:"}),(0,t.jsxs)("select",{id:"itemsPerPage",value:E,onChange:e=>{I(parseInt(e.target.value)),S(1)},className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,t.jsx)("option",{value:10,children:"10"}),(0,t.jsx)("option",{value:25,children:"25"}),(0,t.jsx)("option",{value:50,children:"50"}),(0,t.jsx)("option",{value:100,children:"100"})]}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"lignes"})]}),(0,t.jsx)(u.$,{className:"midnight-blue-btn px-4 py-2 rounded-md font-bold text-sm",onClick:()=>{let e=new Date().toISOString().slice(0,10),s=`Sites_de_reference_export_${e}.csv`,t=r.map(e=>({NOM:e.nom||"",INSTITUTION:e.user?.nomInstitution||"",ABREVIATION:e.user?.abreviation||"",PROJET_RATTACHE:e.nomProjet||"",NOM_PERSONNE_REFERENTE:e.nomPersonneReferente||"",POSTE:e.poste||"",TELEPHONE:e.telephone||"",EMAIL:e.email||"",SUPERFICIE:e.superficie||"",PRATIQUE:e.pratique||"",GEOJSON:JSON.stringify(e.geojson)||"",DESCRIPTION:e.description||"",DATE_CREATION:e.createdAt?new Date(e.createdAt).toLocaleDateString("fr-FR"):"",DERNIERE_MODIFICATION:e.updatedAt?new Date(e.updatedAt).toLocaleDateString("fr-FR"):""}));(0,f.G)(t,s)},disabled:0===r.length,children:"Exporter CSV"})]})]})}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(h.b,{columns:x(e=>{y({open:!0,parcelle:e})},e=>{P({open:!0,parcelle:e})}),data:V})}),F>1&&(0,t.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Affichage de ",D+1," \xe0 ",Math.min(M,U)," sur ",U," r\xe9sultats"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("button",{onClick:()=>L(C-1),disabled:1===C,className:"pagination-btn",children:"← Pr\xe9c\xe9dent"}),(()=>{let e=[];if(F<=5)for(let s=1;s<=F;s++)e.push(s);else if(C<=3){for(let s=1;s<=4;s++)e.push(s);e.push("..."),e.push(F)}else if(C>=F-2){e.push(1),e.push("...");for(let s=F-3;s<=F;s++)e.push(s)}else{e.push(1),e.push("...");for(let s=C-1;s<=C+1;s++)e.push(s);e.push("..."),e.push(F)}return e})().map((e,s)=>(0,t.jsx)("button",{onClick:()=>"number"==typeof e?L(e):null,disabled:"..."===e,className:`pagination-btn ${C===e?"active":""}`,children:e},s)),(0,t.jsx)("button",{onClick:()=>L(C+1),disabled:C===F,className:"pagination-btn",children:"Suivant →"})]})]})})]}),N.open&&N.parcelle&&(0,t.jsx)(j.A,{parcelle:N.parcelle,onClose:()=>{y({open:!1,parcelle:null})}}),_.open&&_.parcelle&&(0,t.jsx)(w,{open:_.open,parcelle:_.parcelle,onClose:()=>{P({open:!1,parcelle:null})}})]})})}}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[176,804,829,995,852,349,899,975,216,489,257],()=>r(3868));module.exports=t})();