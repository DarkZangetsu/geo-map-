(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5823],{1492:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=(0,n(9946).A)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]])},1804:(e,t,n)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"export.csv";if(!e||!e.length)return;let n=[],r=Object.keys(e[0]);for(let t of(n.push(r.join(",")),e)){let e=r.map(e=>{var n;let r=null!=(n=t[e])?n:"";return'"'.concat(String(r).replace(/"/g,'""'),'"')});n.push(e.join(","))}let i=new Blob([n.join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(i),l=document.createElement("a");l.href=s,l.download=t,l.click(),window.URL.revokeObjectURL(s)}n.d(t,{G:()=>r})},2676:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var r=n(5155),i=n(2115),s=n(5384);let l=e=>{let{users:t=[],selectedMembers:n=[],onFilterChange:l}=e,[a,o]=(0,i.useState)(!1),d=Array.isArray(t)?t:[],c=Array.isArray(n)?n:[],u=e=>{l(c.includes(e)?c.filter(t=>t!==e):[...c,e])},m=c.length,h=d.length;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>o(!a),className:"flex items-center justify-between w-full px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,r.jsx)("span",{children:0===m||m===h?"Tous les institutions":"".concat(m," institution(s) s\xe9lectionn\xe9e(s)")}),(0,r.jsx)("svg",{className:"w-5 h-5 ml-2 transition-transform ".concat(a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,r.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsxs)("label",{className:"flex items-center px-3 py-2 text-sm hover:bg-gray-100 rounded cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:m===h&&h>0,onChange:()=>{c.length===d.length?l([]):l(d.map(e=>e.id))},className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsxs)("span",{className:"ml-3 font-medium text-gray-900",children:["S\xe9lectionner tout (",h,")"]})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 my-2"}),d.map(e=>(0,r.jsxs)("label",{className:"flex items-center px-3 py-2 text-sm hover:bg-gray-100 rounded cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>u(e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,r.jsxs)("div",{className:"ml-3 flex items-center",children:[e.logo&&(0,r.jsx)("img",{src:(0,s.D1)(e.logo),alt:"Logo",className:"w-6 h-6 rounded-full mr-2"}),(0,r.jsxs)("span",{className:"text-gray-900",children:[e.firstName," ",e.lastName]}),(0,r.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:e.email})]})]},e.id))]})}),a&&(0,r.jsx)("div",{className:"fixed inset-0 z-0",onClick:()=>o(!1)})]})}},3208:(e,t,n)=>{Promise.resolve().then(n.bind(n,3741))},3741:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var r=n(5155),i=n(2115),s=n(1929),l=n(3593),a=n(5369),o=n(1492),d=n(5623),c=n(183),u=n(7860),m=n(5384);let h=(e,t)=>[{accessorKey:"Nom p\xe9pini\xe8re",header:e=>{let{column:t}=e;return(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)(c.$,{variant:"ghost",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),children:["Nom p\xe9pini\xe8re",(0,r.jsx)(o.A,{className:"ml-2 h-4 w-4"})]})})},cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"text-center",children:t.original.nom})}},{id:"Institutions",header:"Institutions",cell:e=>{let{row:t}=e,n=t.original.user;return(0,r.jsxs)("div",{className:"flex items-center",children:[(null==n?void 0:n.logo)&&(0,r.jsx)("img",{src:(0,m.D1)(n.logo),alt:"Logo",className:"w-6 h-6 rounded-full mr-2"}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:null==n?void 0:n.nomInstitution})})]})}},{id:"Gestionnaire",header:"Gestionnaire",cell:e=>{let{row:t}=e,n=t.original;return(0,r.jsxs)("div",{className:"space-y-1",children:[n.nomGestionnaire&&(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:n.nomGestionnaire}),n.posteGestionnaire&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:n.posteGestionnaire}),n.telephoneGestionnaire&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:n.telephoneGestionnaire}),n.emailGestionnaire&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:n.emailGestionnaire})]})}},{accessorKey:"adresse",header:()=>(0,r.jsx)("div",{className:"text-center",children:"Adresse"}),cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"text-center",children:t.getValue("adresse")||"-"})}},{accessorKey:"Projet rattach\xe9",header:()=>(0,r.jsx)("div",{className:"text-center",children:"Projet rattach\xe9"}),cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"text-center",children:t.original.nomProjet||"-"})}},{id:"actions",header:"Actions",cell:n=>{let{row:i}=n;return(0,r.jsxs)(u.rI,{children:[(0,r.jsx)(u.ty,{asChild:!0,children:(0,r.jsxs)(c.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,r.jsx)("span",{className:"sr-only",children:"Ouvrir le menu"}),(0,r.jsx)(d.A,{className:"h-4 w-4"})]})}),(0,r.jsxs)(u.SQ,{align:"end",children:[(0,r.jsx)(u.lp,{children:"Actions"}),(0,r.jsx)(u._2,{onClick:()=>e(i.original),children:"Voir d\xe9tails"}),(0,r.jsx)(u._2,{onClick:()=>t(i.original),children:"Voir sur la carte"}),(0,r.jsx)(u.mB,{})]})]})},enableSorting:!1,enableHiding:!1}];var x=n(7624);let p={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},g={background:"white",borderRadius:"8px",padding:"24px",width:"600px",minWidth:"350px",height:"500px",minHeight:"400px",maxWidth:"95vw",maxHeight:"95vh",display:"flex",flexDirection:"column"};function b(e){let{open:t,onClose:n,pepiniere:s}=e,[l,a]=i.useState("street");return t&&s?(0,r.jsx)("div",{style:p,children:(0,r.jsxs)("div",{style:g,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h2",{className:"text-lg font-bold",children:"Voir sur la carte"}),(0,r.jsx)("button",{onClick:n,className:"px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:"Fermer"})]}),(0,r.jsxs)("div",{className:"mb-2 flex gap-2 items-center",children:[(0,r.jsx)("label",{htmlFor:"map-style",className:"font-medium",children:"Style de carte :"}),(0,r.jsxs)("select",{id:"map-style",value:l,onChange:e=>a(e.target.value),className:"px-2 py-1 border rounded",children:[(0,r.jsx)("option",{value:"street",children:"Carte routi\xe8re"}),(0,r.jsx)("option",{value:"satellite",children:"Satellite"}),(0,r.jsx)("option",{value:"hybrid",children:"Hybride"})]})]}),(0,r.jsx)("div",{style:{flex:1,minHeight:0},children:(0,r.jsx)(x.A,{pepinieres:[s],style:{height:"100%",width:"100%"},center:[parseFloat(s.latitude)||-18.7669,parseFloat(s.longitude)||46.8691],mapStyle:l})})]})}):null}var f=n(6927),v=n(5753),j=n(2676),N=n(1804),y=n(8048);function w(){let[e,t]=(0,i.useState)([]),[n,o]=(0,i.useState)([]),[d,u]=(0,i.useState)(""),{showError:m,showToast:x}=(0,a.d)(),[p,g]=(0,i.useState)(!1),[w,E]=(0,i.useState)(null),[C,I]=(0,i.useState)({open:!1,pepiniere:null}),[k,S]=(0,i.useState)(1),[A,G]=(0,i.useState)(10);(0,i.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      :root {\n        --midnight-blue: rgb(0,70,144);\n      }\n      .midnight-blue-bg {\n        background-color: var(--midnight-blue) !important;\n        color: #fff !important;\n      }\n      .midnight-blue-text {\n        color: var(--midnight-blue) !important;\n      }\n      .midnight-blue-border {\n        border-color: var(--midnight-blue) !important;\n      }\n      .midnight-blue-btn {\n        background-color: var(--midnight-blue) !important;\n        color: #fff !important;\n        border: 1px solid var(--midnight-blue) !important;\n      }\n      .midnight-blue-btn:hover {\n        background-color: #003366 !important;\n        color: #fff !important;\n      }\n      .pagination-btn {\n        padding: 8px 12px;\n        margin: 0 2px;\n        border: 1px solid #d1d5db;\n        background: white;\n        color: #374151;\n        border-radius: 6px;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      .pagination-btn:hover {\n        background-color: #f3f4f6;\n        border-color: var(--midnight-blue);\n      }\n      .pagination-btn.active {\n        background-color: var(--midnight-blue);\n        color: white;\n        border-color: var(--midnight-blue);\n      }\n      .pagination-btn:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n      .pagination-btn:disabled:hover {\n        background: white;\n        border-color: #d1d5db;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]);let{data:O,loading:T,error:R}=(0,s.IT)(l.KZ),{data:P,loading:L,error:_}=(0,s.IT)(l.em);(0,i.useEffect)(()=>{if(null==O?void 0:O.allPepinieres){let t=O.allPepinieres;if(e.length>0&&(t=t.filter(t=>e.includes(t.user.id))),""!==d.trim()){let e=d.toLowerCase();t=t.filter(t=>{var n,r;return[t.nom,t.adresse,null==(n=t.user)?void 0:n.nomInstitution,null==(r=t.user)?void 0:r.abreviation,t.nomProjet,t.nomGestionnaire,t.posteGestionnaire,t.telephoneGestionnaire,t.emailGestionnaire].some(t=>(t||"").toString().toLowerCase().includes(e))})}o(t),S(1)}},[O,e,d]);let M=n.length,D=Math.ceil(M/A),U=(k-1)*A,F=U+A,H=n.slice(U,F);if(R&&(m("Erreur lors du chargement des p\xe9pini\xe8res"),console.error("Pepinieres error:",R)),_&&(m("Erreur lors du chargement des utilisateurs"),console.error("Users error:",_)),T||L)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600"})});let V=e=>{S(e)};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold midnight-blue-text mb-2",children:"Liste des p\xe9pini\xe8res"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Consultez toutes les p\xe9pini\xe8res de tous les institutions de la plateforme."})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 mb-4 lg:mb-0",children:[(0,r.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Filtrer par institution"}),(0,r.jsx)(j.A,{users:(null==P?void 0:P.allUsers)||[],selectedMembers:e,onFilterChange:e=>{t(e)}})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-medium midnight-blue-text mb-3",children:"Recherche globale"}),(0,r.jsx)("input",{type:"text",value:d,onChange:e=>{u(e.target.value)},placeholder:"Rechercher dans toutes les colonnes...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium midnight-blue-text",children:["P\xe9pini\xe8res (",M,")"]}),e.length>0&&(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["Filtr\xe9 par ",e.length," Information(s)"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{htmlFor:"itemsPerPage",className:"text-sm text-gray-600",children:"Afficher:"}),(0,r.jsxs)("select",{id:"itemsPerPage",value:A,onChange:e=>{G(parseInt(e.target.value)),S(1)},className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,r.jsx)("option",{value:10,children:"10"}),(0,r.jsx)("option",{value:25,children:"25"}),(0,r.jsx)("option",{value:50,children:"50"}),(0,r.jsx)("option",{value:100,children:"100"})]}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"lignes"})]}),(0,r.jsx)(c.$,{className:"midnight-blue-btn px-4 py-2 rounded-md font-bold text-sm",onClick:()=>{let e=new Date().toISOString().slice(0,10),t=n.map(e=>{var t,n;return{NOM:e.nom||"",INSTITUTION:(null==(t=e.user)?void 0:t.nomInstitution)||"",ABREVIATION:(null==(n=e.user)?void 0:n.abreviation)||"",PROJET_RATTACHE:e.nomProjet||"",ADRESSE:e.adresse||"",LATITUDE:e.latitude||"",LONGITUDE:e.longitude||"",DESCRIPTION:e.description||"",NOM_GESTIONNAIRE:e.nomGestionnaire||"",POSTE_GESTIONNAIRE:e.posteGestionnaire||"",TELEPHONE_GESTIONNAIRE:e.telephoneGestionnaire||"",EMAIL_GESTIONNAIRE:e.emailGestionnaire||"",ESPECES_PRODUITES:e.especesProduites||"",QUANTITE_PRODUCTION_GENERALE:e.quantiteProductionGenerale||"",DATE_CREATION:e.createdAt?new Date(e.createdAt).toLocaleDateString("fr-FR"):"",DERNIERE_MODIFICATION:e.updatedAt?new Date(e.updatedAt).toLocaleDateString("fr-FR"):""}});(0,N.G)(t,"pepiniere_export_".concat(e,".csv"))},disabled:0===n.length,children:"Exporter CSV"})]})]})}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)(f.b,{columns:h(e=>E(e),e=>I({open:!0,pepiniere:e})),data:H})}),D>1&&(0,r.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Affichage de ",U+1," \xe0 ",Math.min(F,M)," sur ",M," r\xe9sultats"]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("button",{onClick:()=>V(k-1),disabled:1===k,className:"pagination-btn",children:"← Pr\xe9c\xe9dent"}),(()=>{let e=[];if(D<=5)for(let t=1;t<=D;t++)e.push(t);else if(k<=3){for(let t=1;t<=4;t++)e.push(t);e.push("..."),e.push(D)}else if(k>=D-2){e.push(1),e.push("...");for(let t=D-3;t<=D;t++)e.push(t)}else{e.push(1),e.push("...");for(let t=k-1;t<=k+1;t++)e.push(t);e.push("..."),e.push(D)}return e})().map((e,t)=>(0,r.jsx)("button",{onClick:()=>"number"==typeof e?V(e):null,disabled:"..."===e,className:"pagination-btn ".concat(k===e?"active":""),children:e},t)),(0,r.jsx)("button",{onClick:()=>V(k+1),disabled:k===D,className:"pagination-btn",children:"Suivant →"})]})]})})]}),C.open&&C.pepiniere&&(0,r.jsx)(b,{open:C.open,pepiniere:C.pepiniere,onClose:()=>I({open:!1,pepiniere:null})}),w&&(0,r.jsx)(v.A,{pepiniere:w,onClose:()=>E(null)}),p&&(0,r.jsx)(y.A,{onClose:()=>g(!1),onSuccess:()=>{g(!1),"function"==typeof refetch&&refetch(),x("Export CSV termin\xe9 avec succ\xe8s","success")}})]})})}},5623:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=(0,n(9946).A)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},8095:(e,t,n)=>{"use strict";n.d(t,{n:()=>u});var r=n(9249),i=n(5034),s=n(354),l=n(41),a=n(9691),o=n(2043),d=n(1117),c=n(3705).Sw?i.useLayoutEffect:i.useEffect;function u(e,t){var n=(0,d.m)(null==t?void 0:t.client);(0,a.D$)(e,a.KG.Mutation);var u=i.useState({called:!1,loading:!1,client:n}),m=u[0],h=u[1],x=i.useRef({result:m,mutationId:0,isMounted:!0,client:n,mutation:e,options:t});c(function(){Object.assign(x.current,{client:n,options:t,mutation:e})});var p=i.useCallback(function(e){void 0===e&&(e={});var t=x.current,n=t.options,i=t.mutation,a=(0,r.Cl)((0,r.Cl)({},n),{mutation:i}),d=e.client||x.current.client;x.current.result.loading||a.ignoreResults||!x.current.isMounted||h(x.current.result={loading:!0,error:void 0,data:void 0,called:!0,client:d});var c=++x.current.mutationId,u=(0,s.l)(a,e);return d.mutate(u).then(function(t){var n,r,i=t.data,s=t.errors,a=s&&s.length>0?new o.K4({graphQLErrors:s}):void 0,m=e.onError||(null==(n=x.current.options)?void 0:n.onError);if(a&&m&&m(a,u),c===x.current.mutationId&&!u.ignoreResults){var p={called:!0,loading:!1,data:i,error:a,client:d};x.current.isMounted&&!(0,l.L)(x.current.result,p)&&h(x.current.result=p)}var g=e.onCompleted||(null==(r=x.current.options)?void 0:r.onCompleted);return a||null==g||g(t.data,u),t},function(t){if(c===x.current.mutationId&&x.current.isMounted){var n,r={loading:!1,error:t,data:void 0,called:!0,client:d};(0,l.L)(x.current.result,r)||h(x.current.result=r)}var i=e.onError||(null==(n=x.current.options)?void 0:n.onError);if(i)return i(t,u),{data:void 0,errors:t};throw t})},[]),g=i.useCallback(function(){if(x.current.isMounted){var e={called:!1,loading:!1,client:x.current.client};Object.assign(x.current,{mutationId:0,result:e}),h(e)}},[]);return i.useEffect(function(){var e=x.current;return e.isMounted=!0,function(){e.isMounted=!1}},[]),[p,(0,r.Cl)({reset:g},m)]}}},e=>{var t=t=>e(e.s=t);e.O(0,[2046,1761,2871,8916,1929,59,9547,6800,554,5753,1411,8441,1684,7358],()=>t(3208)),_N_E=e.O()}]);